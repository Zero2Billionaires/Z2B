<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CEO Competitions Manager - Z2B Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .tabs {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .tab {
            padding: 12px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            font-weight: 600;
        }

        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 400px;
        }

        .competitions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .competition-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }

        .competition-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .competition-status {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-draft { background: #e5e7eb; color: #374151; }
        .status-published { background: #dbeafe; color: #1e40af; }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-completed { background: #fde68a; color: #92400e; }

        .competition-card h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .competition-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 15px 0;
            color: #6b7280;
            font-size: 14px;
        }

        .competition-meta div {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close-modal {
            font-size: 28px;
            cursor: pointer;
            color: #6b7280;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .prize-section {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .prize-section h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .leaderboard-table th,
        .leaderboard-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        .leaderboard-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }

        .leaderboard-table tr:hover {
            background: #f9fafb;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .loading i {
            font-size: 48px;
            color: #667eea;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 32px;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1><i class="fas fa-trophy"></i> CEO Competitions Manager</h1>
                <p style="color: #6b7280; margin-top: 10px;">Create, manage, and track quarterly competitions</p>
            </div>
            <button class="btn btn-primary" onclick="openCreateModal()">
                <i class="fas fa-plus"></i> Create Competition
            </button>
        </div>

        <!-- Statistics Dashboard -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <h3 id="statTotal">0</h3>
                <p>Total Competitions</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                <h3 id="statActive">0</h3>
                <p>Active Now</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <h3 id="statPrizePool">R0</h3>
                <p>Total Prize Pool</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                <h3 id="statParticipants">0</h3>
                <p>Total Participants</p>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('all')">All Competitions</div>
            <div class="tab" onclick="switchTab('draft')">Drafts</div>
            <div class="tab" onclick="switchTab('active')">Active</div>
            <div class="tab" onclick="switchTab('completed')">Completed</div>
        </div>

        <!-- Content Area -->
        <div class="content">
            <div id="loadingState" class="loading">
                <i class="fas fa-spinner"></i>
                <p>Loading competitions...</p>
            </div>
            <div id="competitionsContainer" style="display: none;">
                <div id="competitionsGrid" class="competitions-grid"></div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Competition Modal -->
    <div id="competitionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Create New Competition</h2>
                <span class="close-modal" onclick="closeModal()">&times;</span>
            </div>
            <div id="alertContainer"></div>
            <form id="competitionForm" onsubmit="saveCompetition(event)">
                <input type="hidden" id="competitionId">

                <!-- Basic Information -->
                <div class="form-group">
                    <label>Competition Title *</label>
                    <input type="text" id="title" required placeholder="Q1 2026 Sales Championship">
                </div>

                <div class="form-group">
                    <label>Description *</label>
                    <textarea id="description" rows="3" required placeholder="Description of the competition..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Quarter *</label>
                        <select id="quarter" required>
                            <option value="Q1">Q1 (Jan-Mar)</option>
                            <option value="Q2">Q2 (Apr-Jun)</option>
                            <option value="Q3">Q3 (Jul-Sep)</option>
                            <option value="Q4">Q4 (Oct-Dec)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Year *</label>
                        <input type="number" id="year" required value="2026" min="2024" max="2030">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date *</label>
                        <input type="date" id="startDate" required>
                    </div>
                    <div class="form-group">
                        <label>End Date *</label>
                        <input type="date" id="endDate" required>
                    </div>
                </div>

                <!-- Target Configuration -->
                <div class="form-group">
                    <label>Target Type *</label>
                    <select id="targetType" required>
                        <option value="sales">Total Sales (R)</option>
                        <option value="recruits">Number of Recruits</option>
                        <option value="team_pv">Team PV</option>
                        <option value="personal_pv">Personal PV</option>
                        <option value="team_growth">Team Growth %</option>
                        <option value="custom">Custom Target</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Target Value *</label>
                        <input type="number" id="targetValue" required placeholder="10000">
                    </div>
                    <div class="form-group">
                        <label>Target Description *</label>
                        <input type="text" id="targetDescription" required placeholder="Achieve R10,000 in sales">
                    </div>
                </div>

                <!-- Eligibility -->
                <div class="form-group">
                    <label>Eligible Tiers (Select Multiple) *</label>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; padding: 10px; background: #f9fafb; border-radius: 8px;">
                        <label style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 5px; cursor: pointer;">
                            <input type="checkbox" id="tier-fam" value="FAM" checked>
                            FAM
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 5px; cursor: pointer;">
                            <input type="checkbox" id="tier-bronze" value="Bronze" checked>
                            Bronze
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 5px; cursor: pointer;">
                            <input type="checkbox" id="tier-copper" value="Copper" checked>
                            Bronze
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 5px; cursor: pointer;">
                            <input type="checkbox" id="tier-silver" value="Silver" checked>
                            Silver
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 5px; cursor: pointer;">
                            <input type="checkbox" id="tier-gold" value="Gold" checked>
                            Gold
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; padding: 8px 12px; background: white; border-radius: 5px; cursor: pointer;">
                            <input type="checkbox" id="tier-platinum" value="Platinum" checked>
                            Platinum
                        </label>
                    </div>
                    <small style="color: #6b7280; margin-top: 5px; display: block;">Diamond tier excluded (White Label members don't participate in competitions)</small>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="newMembersOnly" style="width: 18px; height: 18px;">
                        New Members Only (joined within competition period)
                    </label>
                    <small style="color: #6b7280; margin-top: 5px; display: block;">Check this to limit competition to members who join during the competition period</small>
                </div>

                <div class="form-group">
                    <label>Custom Eligibility Rules</label>
                    <textarea id="customRules" rows="3" placeholder="e.g., Must have at least 2 direct referrals, Must be active for 30+ days, etc." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit;"></textarea>
                    <small style="color: #6b7280; margin-top: 5px; display: block;">Add any additional qualification requirements (optional)</small>
                </div>

                <!-- Prizes -->
                <div class="prize-section">
                    <h4><i class="fas fa-trophy"></i> 1st Place Prize</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prize Amount (R) *</label>
                            <input type="number" id="firstAmount" required placeholder="50000">
                        </div>
                        <div class="form-group">
                            <label>Prize Type</label>
                            <select id="firstType">
                                <option value="cash">Cash</option>
                                <option value="car">Car</option>
                                <option value="trip">Trip/Holiday</option>
                                <option value="bonus">Bonus</option>
                                <option value="product">Product</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Prize Description</label>
                        <input type="text" id="firstDescription" placeholder="R50,000 Cash Prize">
                    </div>
                </div>

                <div class="prize-section">
                    <h4><i class="fas fa-medal"></i> 2nd Place Prize</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prize Amount (R)</label>
                            <input type="number" id="secondAmount" placeholder="30000">
                        </div>
                        <div class="form-group">
                            <label>Prize Type</label>
                            <select id="secondType">
                                <option value="cash">Cash</option>
                                <option value="car">Car</option>
                                <option value="trip">Trip/Holiday</option>
                                <option value="bonus">Bonus</option>
                                <option value="product">Product</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Prize Description</label>
                        <input type="text" id="secondDescription" placeholder="R30,000 Cash Prize">
                    </div>
                </div>

                <div class="prize-section">
                    <h4><i class="fas fa-award"></i> 3rd Place Prize</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Prize Amount (R)</label>
                            <input type="number" id="thirdAmount" placeholder="20000">
                        </div>
                        <div class="form-group">
                            <label>Prize Type</label>
                            <select id="thirdType">
                                <option value="cash">Cash</option>
                                <option value="car">Car</option>
                                <option value="trip">Trip/Holiday</option>
                                <option value="bonus">Bonus</option>
                                <option value="product">Product</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Prize Description</label>
                        <input type="text" id="thirdDescription" placeholder="R20,000 Cash Prize">
                    </div>
                </div>

                <!-- Form Actions -->
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Competition
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Competition Details Modal -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-trophy"></i> Competition Details</h2>
                <span class="close-modal" onclick="closeDetailsModal()">&times;</span>
            </div>
            <div id="competitionDetails"></div>
        </div>
    </div>

    <script src="../js/app-config.js"></script>
    <script>
        let currentFilter = 'all';
        let competitions = [];

        // Load competitions on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadCompetitions();
        });

        async function loadCompetitions(filter = 'all') {
            try {
                const url = filter === 'all'
                    ? `${API_CONFIG.BASE_URL}/ceo-competitions`
                    : `${API_CONFIG.BASE_URL}/ceo-competitions?status=${filter}`;

                const response = await fetch(url);
                const data = await response.json();

                if (data.success) {
                    competitions = data.competitions;
                    displayCompetitions(competitions);
                    updateStats(competitions);
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('competitionsContainer').style.display = 'block';
                } else {
                    showAlert('error', 'Failed to load competitions');
                }
            } catch (error) {
                console.error('Error loading competitions:', error);
                showAlert('error', 'Failed to load competitions: ' + error.message);
                document.getElementById('loadingState').style.display = 'none';
            }
        }

        function displayCompetitions(comps) {
            const grid = document.getElementById('competitionsGrid');

            if (comps.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-trophy"></i>
                        <h3>No competitions found</h3>
                        <p>Create your first competition to get started</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = comps.map(comp => `
                <div class="competition-card">
                    <span class="competition-status status-${comp.status}">${comp.status}</span>
                    <h3>${comp.title}</h3>
                    <p style="color: #6b7280; margin-bottom: 15px;">${comp.description}</p>
                    <div class="competition-meta">
                        <div><i class="fas fa-calendar"></i> ${comp.quarter} ${comp.year}</div>
                        <div><i class="fas fa-clock"></i> ${formatDate(comp.startDate)} - ${formatDate(comp.endDate)}</div>
                        <div><i class="fas fa-bullseye"></i> ${comp.targetDescription}</div>
                        <div><i class="fas fa-money-bill"></i> Total Prize Pool: R${comp.totalPrizePool.toLocaleString()}</div>
                        <div><i class="fas fa-users"></i> ${comp.participants?.length || 0} Participants</div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary" onclick="viewDetails('${comp._id}')">
                            <i class="fas fa-eye"></i> View
                        </button>
                        ${comp.status === 'draft' ? `
                            <button class="btn btn-warning" onclick="editCompetition('${comp._id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-success" onclick="publishCompetition('${comp._id}')">
                                <i class="fas fa-paper-plane"></i> Publish
                            </button>
                            <button class="btn btn-danger" onclick="deleteCompetition('${comp._id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        ` : ''}
                        ${comp.status === 'active' ? `
                            <button class="btn btn-warning" onclick="finalizeCompetition('${comp._id}')">
                                <i class="fas fa-flag-checkered"></i> Finalize
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function updateStats(comps) {
            document.getElementById('statTotal').textContent = comps.length;
            document.getElementById('statActive').textContent = comps.filter(c => c.status === 'active').length;

            const totalPrizePool = comps.reduce((sum, c) => sum + (c.totalPrizePool || 0), 0);
            document.getElementById('statPrizePool').textContent = 'R' + totalPrizePool.toLocaleString();

            const totalParticipants = comps.reduce((sum, c) => sum + (c.participants?.length || 0), 0);
            document.getElementById('statParticipants').textContent = totalParticipants;
        }

        function switchTab(filter) {
            currentFilter = filter;

            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            loadCompetitions(filter === 'all' ? 'all' : filter);
        }

        function openCreateModal() {
            document.getElementById('modalTitle').textContent = 'Create New Competition';
            document.getElementById('competitionForm').reset();
            document.getElementById('competitionId').value = '';
            document.getElementById('competitionModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('competitionModal').classList.remove('active');
        }

        async function saveCompetition(event) {
            event.preventDefault();

            const competitionId = document.getElementById('competitionId').value;
            const competitionData = {
                title: document.getElementById('title').value,
                description: document.getElementById('description').value,
                quarter: document.getElementById('quarter').value,
                year: parseInt(document.getElementById('year').value),
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                targetType: document.getElementById('targetType').value,
                targetValue: parseFloat(document.getElementById('targetValue').value),
                targetDescription: document.getElementById('targetDescription').value,
                eligibility: {
                    minTier: document.getElementById('minTier').value,
                    allMembers: document.getElementById('minTier').value === 'FAM'
                },
                prizes: {
                    first: {
                        amount: parseFloat(document.getElementById('firstAmount').value),
                        type: document.getElementById('firstType').value,
                        description: document.getElementById('firstDescription').value
                    },
                    second: document.getElementById('secondAmount').value ? {
                        amount: parseFloat(document.getElementById('secondAmount').value),
                        type: document.getElementById('secondType').value,
                        description: document.getElementById('secondDescription').value
                    } : undefined,
                    third: document.getElementById('thirdAmount').value ? {
                        amount: parseFloat(document.getElementById('thirdAmount').value),
                        type: document.getElementById('thirdType').value,
                        description: document.getElementById('thirdDescription').value
                    } : undefined
                }
            };

            try {
                const url = competitionId
                    ? `${API_CONFIG.BASE_URL}/ceo-competitions/${competitionId}`
                    : `${API_CONFIG.BASE_URL}/ceo-competitions`;

                const method = competitionId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(competitionData)
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('success', competitionId ? 'Competition updated successfully!' : 'Competition created successfully!');
                    closeModal();
                    loadCompetitions(currentFilter);
                } else {
                    showAlert('error', data.message || 'Failed to save competition');
                }
            } catch (error) {
                console.error('Error saving competition:', error);
                showAlert('error', 'Failed to save competition: ' + error.message);
            }
        }

        async function editCompetition(id) {
            const comp = competitions.find(c => c._id === id);
            if (!comp) return;

            document.getElementById('modalTitle').textContent = 'Edit Competition';
            document.getElementById('competitionId').value = comp._id;
            document.getElementById('title').value = comp.title;
            document.getElementById('description').value = comp.description;
            document.getElementById('quarter').value = comp.quarter;
            document.getElementById('year').value = comp.year;
            document.getElementById('startDate').value = comp.startDate.split('T')[0];
            document.getElementById('endDate').value = comp.endDate.split('T')[0];
            document.getElementById('targetType').value = comp.targetType;
            document.getElementById('targetValue').value = comp.targetValue;
            document.getElementById('targetDescription').value = comp.targetDescription;
            document.getElementById('minTier').value = comp.eligibility?.minTier || 'FAM';

            if (comp.prizes?.first) {
                document.getElementById('firstAmount').value = comp.prizes.first.amount;
                document.getElementById('firstType').value = comp.prizes.first.type;
                document.getElementById('firstDescription').value = comp.prizes.first.description || '';
            }

            if (comp.prizes?.second) {
                document.getElementById('secondAmount').value = comp.prizes.second.amount;
                document.getElementById('secondType').value = comp.prizes.second.type;
                document.getElementById('secondDescription').value = comp.prizes.second.description || '';
            }

            if (comp.prizes?.third) {
                document.getElementById('thirdAmount').value = comp.prizes.third.amount;
                document.getElementById('thirdType').value = comp.prizes.third.type;
                document.getElementById('thirdDescription').value = comp.prizes.third.description || '';
            }

            document.getElementById('competitionModal').classList.add('active');
        }

        async function publishCompetition(id) {
            if (!confirm('Are you sure you want to publish this competition? Members will be able to see it.')) return;

            try {
                const response = await fetch(`${API_CONFIG.BASE_URL}/ceo-competitions/${id}/publish`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('success', 'Competition published successfully!');
                    loadCompetitions(currentFilter);
                } else {
                    showAlert('error', data.message || 'Failed to publish competition');
                }
            } catch (error) {
                console.error('Error publishing competition:', error);
                showAlert('error', 'Failed to publish competition: ' + error.message);
            }
        }

        async function finalizeCompetition(id) {
            if (!confirm('Are you sure you want to finalize this competition? This will select winners and cannot be undone.')) return;

            try {
                const response = await fetch(`${API_CONFIG.BASE_URL}/ceo-competitions/${id}/finalize`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('success', `Competition finalized! ${data.winners.length} winners selected.`);
                    loadCompetitions(currentFilter);
                    viewDetails(id);
                } else {
                    showAlert('error', data.message || 'Failed to finalize competition');
                }
            } catch (error) {
                console.error('Error finalizing competition:', error);
                showAlert('error', 'Failed to finalize competition: ' + error.message);
            }
        }

        async function deleteCompetition(id) {
            if (!confirm('Are you sure you want to delete this competition? This action cannot be undone.')) return;

            try {
                const response = await fetch(`${API_CONFIG.BASE_URL}/ceo-competitions/${id}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showAlert('success', 'Competition deleted successfully!');
                    loadCompetitions(currentFilter);
                } else {
                    showAlert('error', data.message || 'Failed to delete competition');
                }
            } catch (error) {
                console.error('Error deleting competition:', error);
                showAlert('error', 'Failed to delete competition: ' + error.message);
            }
        }

        async function viewDetails(id) {
            try {
                const response = await fetch(`${API_CONFIG.BASE_URL}/ceo-competitions/${id}`);
                const data = await response.json();

                if (data.success) {
                    const comp = data.competition;
                    const leaderboard = comp.participants?.sort((a, b) => b.currentProgress - a.currentProgress) || [];

                    document.getElementById('competitionDetails').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <h3>${comp.title}</h3>
                            <p style="color: #6b7280;">${comp.description}</p>
                            <div class="competition-meta" style="margin-top: 15px;">
                                <div><i class="fas fa-calendar"></i> ${comp.quarter} ${comp.year}</div>
                                <div><i class="fas fa-clock"></i> ${formatDate(comp.startDate)} - ${formatDate(comp.endDate)}</div>
                                <div><i class="fas fa-bullseye"></i> ${comp.targetDescription}</div>
                                <div><i class="fas fa-users"></i> ${comp.participants?.length || 0} Participants</div>
                            </div>
                        </div>

                        <h4 style="margin-top: 30px; margin-bottom: 15px;"><i class="fas fa-trophy"></i> Prizes</h4>
                        <div style="display: grid; gap: 10px; margin-bottom: 30px;">
                            ${comp.prizes?.first ? `
                                <div style="padding: 15px; background: #fef3c7; border-radius: 8px;">
                                    <strong>1st Place:</strong> R${comp.prizes.first.amount.toLocaleString()} - ${comp.prizes.first.description || comp.prizes.first.type}
                                </div>
                            ` : ''}
                            ${comp.prizes?.second ? `
                                <div style="padding: 15px; background: #e0e7ff; border-radius: 8px;">
                                    <strong>2nd Place:</strong> R${comp.prizes.second.amount.toLocaleString()} - ${comp.prizes.second.description || comp.prizes.second.type}
                                </div>
                            ` : ''}
                            ${comp.prizes?.third ? `
                                <div style="padding: 15px; background: #fce7f3; border-radius: 8px;">
                                    <strong>3rd Place:</strong> R${comp.prizes.third.amount.toLocaleString()} - ${comp.prizes.third.description || comp.prizes.third.type}
                                </div>
                            ` : ''}
                        </div>

                        ${comp.winners && comp.winners.length > 0 ? `
                            <h4 style="margin-bottom: 15px;"><i class="fas fa-crown"></i> Winners</h4>
                            <table class="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th>Position</th>
                                        <th>Member</th>
                                        <th>Final Score</th>
                                        <th>Prize</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${comp.winners.map(w => `
                                        <tr>
                                            <td><strong>${w.position}</strong></td>
                                            <td>${w.memberName} (${w.membershipNumber})</td>
                                            <td>${w.finalScore}</td>
                                            <td>R${w.prizeAmount.toLocaleString()}</td>
                                            <td><span class="badge" style="background: ${w.paymentStatus === 'paid' ? '#10b981' : '#f59e0b'}; color: white;">${w.paymentStatus}</span></td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        ` : ''}

                        ${leaderboard.length > 0 ? `
                            <h4 style="margin-top: 30px; margin-bottom: 15px;"><i class="fas fa-chart-line"></i> Leaderboard</h4>
                            <table class="leaderboard-table">
                                <thead>
                                    <tr>
                                        <th>Rank</th>
                                        <th>Member</th>
                                        <th>Tier</th>
                                        <th>Progress</th>
                                        <th>% of Target</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${leaderboard.slice(0, 20).map((p, index) => `
                                        <tr>
                                            <td><strong>${index + 1}</strong></td>
                                            <td>${p.memberName} (${p.membershipNumber})</td>
                                            <td>${p.tier}</td>
                                            <td>${p.currentProgress}</td>
                                            <td>${((p.currentProgress / comp.targetValue) * 100).toFixed(1)}%</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        ` : '<p style="text-align: center; color: #6b7280; padding: 20px;">No participants yet</p>'}
                    `;

                    document.getElementById('detailsModal').classList.add('active');
                } else {
                    showAlert('error', 'Failed to load competition details');
                }
            } catch (error) {
                console.error('Error loading competition details:', error);
                showAlert('error', 'Failed to load competition details: ' + error.message);
            }
        }

        function closeDetailsModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-ZA', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            const alertClass = type === 'success' ? 'alert-success' : 'alert-error';

            alertContainer.innerHTML = `
                <div class="alert ${alertClass}">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    ${message}
                </div>
            `;

            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 5000);
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }
    </script>
</body>
</html>
