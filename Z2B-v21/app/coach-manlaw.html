<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach Manlaw - 7-Stage Employee to Entrepreneur Transformation | Z2B</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Futuristic Royal Gold */
            --royal-gold: #FFD700;
            --royal-gold-light: #FFED4E;
            --royal-gold-dark: #D4AF37;
            --royal-gold-shine: #FFF9C4;
            --royal-gold-deep: #B8860B;
            --gold-glow: rgba(255, 215, 0, 0.6);

            /* Futuristic Royal Blue */
            --royal-blue: #0A1F44;
            --royal-blue-light: #1E3A8A;
            --royal-blue-bright: #2563EB;
            --royal-blue-neon: #60A5FA;
            --royal-blue-deep: #030B1F;
            --blue-glow: rgba(37, 99, 235, 0.5);

            /* Cyber Accents */
            --cyber-cyan: #00D9FF;
            --cyber-purple: #B45FFF;
            --neon-pink: #FF006E;
            --electric-blue: #0066FF;

            /* Base Colors */
            --white: #FFFFFF;
            --black: #000000;
            --success: #00FF88;
            --warning: #FFB800;

            /* Legacy aliases */
            --gold: var(--royal-gold);
            --light-gold: var(--royal-gold-light);
            --deep-navy: var(--royal-blue);
            --navy-blue: var(--royal-blue-light);
            --dark-navy: var(--royal-blue-deep);
            --orange: var(--royal-gold-dark);
            --border-color: var(--gold-glow);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background:
                radial-gradient(ellipse at top left, var(--royal-blue-bright) 0%, transparent 50%),
                radial-gradient(ellipse at bottom right, var(--royal-gold-dark) 0%, transparent 50%),
                linear-gradient(135deg, var(--royal-blue-deep) 0%, var(--royal-blue) 50%, var(--royal-blue-deep) 100%);
            color: var(--white);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 215, 0, 0.03) 2px,
                    rgba(255, 215, 0, 0.03) 4px
                );
            pointer-events: none;
            z-index: 1;
        }

        .coach-container {
            display: grid;
            grid-template-columns: 320px 1fr;
            height: 100vh;
            position: relative;
            z-index: 10;
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, rgba(10, 31, 68, 0.95) 0%, rgba(3, 11, 31, 0.98) 100%);
            padding: 2rem 1.5rem;
            border-right: 3px solid var(--royal-gold);
            box-shadow:
                inset -3px 0 15px var(--gold-glow),
                5px 0 30px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            position: relative;
        }

        .sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 3px;
            height: 100%;
            background: linear-gradient(180deg, transparent, var(--royal-gold), transparent);
            animation: borderGlow 3s ease-in-out infinite;
        }

        @keyframes borderGlow {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
                filter: drop-shadow(0 0 10px var(--royal-gold));
            }
        }

        .back-btn {
            color: var(--gold);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            color: var(--orange);
            transform: translateX(-5px);
        }

        .coach-avatar-lg {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 50%, var(--royal-gold-dark) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 5rem;
            margin: 0 auto 1.5rem;
            border: 4px solid var(--royal-gold);
            box-shadow:
                0 0 30px var(--gold-glow),
                0 0 60px rgba(255, 215, 0, 0.3),
                inset 0 0 20px rgba(255, 255, 255, 0.2);
            animation: pulseGlow 3s ease-in-out infinite;
            position: relative;
        }

        .coach-avatar-lg::before {
            content: '';
            position: absolute;
            inset: -10px;
            border-radius: 50%;
            background: conic-gradient(
                var(--royal-gold),
                var(--royal-blue-bright),
                var(--royal-gold)
            );
            opacity: 0.5;
            filter: blur(20px);
            animation: rotate 4s linear infinite;
            z-index: -1;
        }

        @keyframes pulseGlow {
            0%, 100% {
                transform: scale(1);
                box-shadow:
                    0 0 30px var(--gold-glow),
                    0 0 60px rgba(255, 215, 0, 0.3),
                    inset 0 0 20px rgba(255, 255, 255, 0.2);
            }
            50% {
                transform: scale(1.05);
                box-shadow:
                    0 0 50px var(--gold-glow),
                    0 0 80px rgba(255, 215, 0, 0.5),
                    inset 0 0 30px rgba(255, 255, 255, 0.3);
            }
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
            }
            50% {
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            }
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .coach-name {
            text-align: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .coach-status {
            text-align: center;
            color: var(--white);
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00ff00;
            margin-right: 5px;
            animation: blink 2s ease-in-out infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.3;
            }
        }

        .btss-panel {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(10, 31, 68, 0.5) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow:
                0 4px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .btss-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .btss-panel h5 {
            color: var(--royal-gold);
            margin-bottom: 1rem;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--gold-glow);
        }

        .leg-bar {
            margin-bottom: 1rem;
        }

        .leg-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--royal-gold-light);
        }

        .bar-container {
            width: 100%;
            height: 10px;
            background: rgba(3, 11, 31, 0.8);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg,
                var(--royal-blue-bright) 0%,
                var(--cyber-cyan) 50%,
                var(--royal-gold) 100%);
            border-radius: 10px;
            transition: width 1s ease;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.6);
            position: relative;
            overflow: hidden;
        }

        .bar-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: barShine 2s infinite;
        }

        @keyframes barShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .stats-box {
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 100%);
            padding: 1rem;
            border-radius: 15px;
            text-align: center;
            color: var(--royal-blue-deep);
            margin-bottom: 1rem;
            border: 2px solid var(--royal-gold-shine);
            box-shadow:
                0 8px 25px rgba(255, 215, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .stats-box::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            animation: statsShine 3s infinite;
        }

        @keyframes statsShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }

        .stats-label {
            font-size: 0.85rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        .sidebar-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .sidebar-btn {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.5) 0%, rgba(10, 31, 68, 0.7) 100%);
            border: 2px solid var(--royal-gold);
            padding: 0.8rem;
            border-radius: 10px;
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .sidebar-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.5s;
        }

        .sidebar-btn:hover::before {
            left: 100%;
        }

        .sidebar-btn:hover {
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 100%);
            color: var(--royal-blue-deep);
            border-color: var(--royal-gold-shine);
            box-shadow:
                0 0 20px var(--gold-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        /* Chat Area */
        .chat-area {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .chat-header {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.8) 0%, rgba(10, 31, 68, 0.9) 100%);
            padding: 1.5rem 2rem;
            border-bottom: 3px solid var(--royal-gold);
            box-shadow:
                0 4px 20px rgba(0, 0, 0, 0.3),
                inset 0 -3px 15px var(--gold-glow);
            position: relative;
        }

        .chat-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg,
                transparent,
                var(--royal-gold),
                transparent);
            animation: headerScan 3s ease-in-out infinite;
        }

        @keyframes headerScan {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .chat-header h2 {
            color: var(--royal-gold);
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
            text-shadow: 0 0 20px var(--gold-glow);
            letter-spacing: 1px;
        }

        .chat-header p {
            color: var(--white);
            opacity: 0.9;
            font-size: 0.95rem;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background:
                linear-gradient(180deg, rgba(10, 31, 68, 0.3) 0%, rgba(3, 11, 31, 0.5) 100%);
        }

        .message {
            display: flex;
            margin-bottom: 1.5rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.coach {
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold), var(--orange));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            margin-right: 0;
            margin-left: 1rem;
            order: 2;
            background: linear-gradient(135deg, var(--deep-navy), var(--navy-blue));
        }

        .message-content {
            max-width: 70%;
            background: rgba(255, 255, 255, 0.95);
            padding: 1.2rem 1.5rem;
            border-radius: 20px;
            color: var(--dark-navy);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .message-content strong {
            color: var(--dark-text);
            font-weight: 700;
        }

        .message-content em {
            color: var(--medium-text);
            font-style: italic;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--gold), var(--orange));
            color: var(--navy-blue);
        }

        .message-text {
            line-height: 1.6;
            margin-bottom: 0.5rem;
            color: var(--medium-text);
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.6;
            text-align: right;
            color: var(--dark-navy);
        }

        .typing-indicator {
            display: none;
            padding: 1rem 1.5rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            width: fit-content;
        }

        .typing-indicator.active {
            display: block;
        }

        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--navy-blue);
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {

            0%,
            60%,
            100% {
                opacity: 0.3;
                transform: translateY(0);
            }

            30% {
                opacity: 1;
                transform: translateY(-10px);
            }
        }

        /* Input Area */
        .chat-input-area {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.8) 0%, rgba(10, 31, 68, 0.9) 100%);
            padding: 1.5rem 2rem;
            border-top: 3px solid var(--royal-gold);
            box-shadow:
                0 -4px 20px rgba(0, 0, 0, 0.3),
                inset 0 3px 15px var(--gold-glow);
        }

        .quick-actions {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.6) 0%, rgba(10, 31, 68, 0.8) 100%);
            border: 2px solid rgba(255, 215, 0, 0.4);
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            color: var(--white);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .quick-action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: left 0.5s;
        }

        .quick-action-btn:hover::before {
            left: 100%;
        }

        .quick-action-btn:hover {
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 100%);
            color: var(--royal-blue-deep);
            border-color: var(--royal-gold-shine);
            box-shadow: 0 0 15px var(--gold-glow);
        }

        .input-container {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input {
            flex: 1;
            background: rgba(3, 11, 31, 0.8);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 50px;
            padding: 1rem 1.5rem;
            color: var(--white);
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .chat-input:focus {
            outline: none;
            background: rgba(3, 11, 31, 0.9);
            border-color: var(--royal-gold);
            box-shadow:
                inset 0 2px 10px rgba(0, 0, 0, 0.5),
                0 0 20px var(--gold-glow);
        }

        .chat-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-send {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 100%);
            border: 2px solid var(--royal-gold-shine);
            color: var(--royal-blue-deep);
            font-size: 1.3rem;
            transition: all 0.3s;
            cursor: pointer;
            box-shadow:
                0 4px 15px var(--gold-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
        }

        .btn-send::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.4) 50%, transparent 70%);
            animation: buttonShine 2s infinite;
        }

        @keyframes buttonShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-send:hover:not(:disabled) {
            transform: scale(1.1);
            box-shadow:
                0 8px 30px var(--gold-glow),
                0 0 40px rgba(255, 215, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .btn-send:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Assessment Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(3, 11, 31, 0.95);
            backdrop-filter: blur(10px);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-overlay.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--royal-blue) 0%, var(--royal-blue-deep) 100%);
            border-radius: 20px;
            padding: 2rem;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid var(--royal-gold);
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.6),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 0 40px var(--gold-glow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 1rem;
        }

        .modal-header h3 {
            color: var(--royal-gold);
            font-size: 1.8rem;
            margin: 0;
            text-shadow: 0 0 20px var(--gold-glow);
            letter-spacing: 1px;
        }

        .btn-close {
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 100%);
            border: 2px solid var(--royal-gold-shine);
            color: var(--royal-blue-deep);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px var(--gold-glow);
        }

        .btn-close:hover {
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 8px 25px var(--gold-glow);
        }

        .assessment-form {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .assessment-item {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3) 0%, rgba(10, 31, 68, 0.5) 100%);
            padding: 1.5rem;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.2);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .assessment-item h4 {
            color: var(--royal-gold);
            margin-bottom: 0.5rem;
            text-shadow: 0 0 10px var(--gold-glow);
        }

        .assessment-item p {
            color: var(--white);
            opacity: 0.9;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .slider {
            flex: 1;
            height: 10px;
            border-radius: 10px;
            background: rgba(3, 11, 31, 0.8);
            border: 1px solid rgba(255, 215, 0, 0.3);
            outline: none;
            appearance: none;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .slider::-webkit-slider-track {
            height: 10px;
            border-radius: 10px;
            background: transparent;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 100%);
            border: 2px solid var(--royal-gold-shine);
            cursor: pointer;
            box-shadow:
                0 0 15px var(--gold-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            transition: all 0.3s;
        }

        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow:
                0 0 25px var(--gold-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--royal-gold) 0%, var(--royal-gold-light) 100%);
            border: 2px solid var(--royal-gold-shine);
            cursor: pointer;
            box-shadow:
                0 0 15px var(--gold-glow),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .slider-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--gold);
            min-width: 50px;
            text-align: center;
        }

        .btn-submit {
            width: 100%;
            padding: 1.2rem;
            background: linear-gradient(135deg, var(--gold), var(--orange));
            color: var(--navy-blue);
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 1rem;
        }

        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
        }

        /* Scrollbar */
        .chat-messages::-webkit-scrollbar,
        .sidebar::-webkit-scrollbar,
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track,
        .sidebar::-webkit-scrollbar-track,
        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .chat-messages::-webkit-scrollbar-thumb,
        .sidebar::-webkit-scrollbar-thumb,
        .modal-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--gold), var(--orange));
            border-radius: 10px;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .coach-container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                display: none;
            }

            .message-content {
                max-width: 85%;
            }
        }
    </style>
</head>

<body>
    <div class="coach-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <a href="dashboard.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> Dashboard
            </a>

            <div class="coach-avatar-lg">üéØ</div>
            <h3 class="coach-name">Coach Manlaw</h3>
            <p class="coach-status">
                <span class="status-indicator"></span>
                Online & Ready
            </p>

            <div class="btss-panel">
                <h5><i class="fas fa-chart-line"></i> Four Legs Progress</h5>
                <div class="leg-bar">
                    <div class="leg-label">
                        <span>üß† Mindset Mystery</span>
                        <span id="mindsetScore">--</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-fill" id="mindsetBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="leg-bar">
                    <div class="leg-label">
                        <span>üí∏ Money Moves</span>
                        <span id="moneyScore">--</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-fill" id="moneyBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="leg-bar">
                    <div class="leg-label">
                        <span>‚öôÔ∏è Legacy Missions</span>
                        <span id="legacyScore">--</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-fill" id="legacyBar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="leg-bar">
                    <div class="leg-label">
                        <span>üåç Momentum Movement</span>
                        <span id="movementScore">--</span>
                    </div>
                    <div class="bar-container">
                        <div class="bar-fill" id="movementBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Current Stage Tracker -->
            <div class="btss-panel" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 107, 53, 0.15)); border: 2px solid var(--gold);">
                <h5 style="margin-bottom: 0.8rem;"><i class="fas fa-rocket"></i> Your Transformation Stage</h5>
                <div style="text-align: center; margin-bottom: 1rem;">
                    <div style="font-size: 2rem; font-weight: 800; color: var(--gold); margin-bottom: 0.3rem;" id="stageNumber">Stage 1</div>
                    <div style="font-size: 1.1rem; font-weight: 600; color: var(--white); margin-bottom: 0.3rem;" id="stageName">Awakening</div>
                    <div style="font-size: 0.9rem; color: var(--gold); font-weight: 500; font-style: italic; margin-bottom: 0.5rem;" id="stageSubtitle"></div>
                    <div style="font-size: 0.85rem; color: var(--orange); font-weight: 500;" id="stageLeg">üß† Mindset Mystery</div>
                </div>
                <div style="font-size: 0.75rem; color: var(--white); opacity: 0.8; text-align: center; font-style: italic; line-height: 1.3;" id="stageQuote">
                    "I'm not building my dream. I'm helping someone else build theirs."
                </div>
            </div>

            <div class="stats-box">
                <div class="stats-number" id="statsDay">Day 1</div>
                <div class="stats-label">Your Journey</div>
            </div>

            <div class="stats-box" style="background: linear-gradient(135deg, var(--success), var(--purple));">
                <div class="stats-number" id="statsOverall">0%</div>
                <div class="stats-label">Overall BTSS</div>
            </div>

            <!-- Current Lesson Card -->
            <div class="btss-panel" id="lessonCard" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.15), rgba(212, 175, 55, 0.15)); border: 2px solid var(--gold);">
                <h5 style="margin-bottom: 0.8rem;"><i class="fas fa-book-open"></i> Today's Lesson</h5>
                <div style="margin-bottom: 1rem;">
                    <div style="font-size: 0.75rem; color: var(--orange); font-weight: 600; margin-bottom: 0.3rem;">
                        <span id="lessonWeekPhase">WEEK 1 ‚Ä¢ MINDSET MYSTERY</span>
                    </div>
                    <div style="font-size: 0.95rem; color: var(--gold); font-weight: 700; line-height: 1.3;" id="lessonTitle">
                        The Employee Trap: Why You're Stuck
                    </div>
                </div>
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.8rem;">
                    <button class="sidebar-btn" style="flex: 1; padding: 0.5rem; font-size: 0.75rem;" onclick="viewLesson()">
                        <i class="fas fa-eye"></i> View
                    </button>
                    <button class="sidebar-btn" style="flex: 1; padding: 0.5rem; font-size: 0.75rem;" onclick="completeLesson()">
                        <i class="fas fa-check"></i> Complete
                    </button>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="sidebar-btn" style="flex: 1; padding: 0.5rem; font-size: 0.75rem;" onclick="previousDay()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="sidebar-btn" style="flex: 1; padding: 0.5rem; font-size: 0.75rem;" onclick="nextDay()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <div class="sidebar-buttons">
                <button class="sidebar-btn" onclick="openAssessment()">
                    <i class="fas fa-clipboard-check"></i> Take BTSS Assessment
                </button>
                <button class="sidebar-btn" onclick="showProgress()">
                    <i class="fas fa-chart-line"></i> View Progress
                </button>
                <button class="sidebar-btn" onclick="viewJournal()">
                    <i class="fas fa-book-open"></i> My Journal
                </button>
                <button class="sidebar-btn" onclick="showSettings()">
                    <i class="fas fa-cog"></i> AI Settings
                </button>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-header">
                <h2><i class="fas fa-graduation-cap"></i> Coach Manlaw</h2>
                <p id="headerStatus">Transforming Employees into Entrepreneurs Through the 7-Stage Journey</p>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Welcome Message -->
                <div class="message coach">
                    <div class="message-avatar">üéØ</div>
                    <div class="message-content">
                        <div class="message-text">
                            <strong>Hey Employee, Ready to Break Free? üëã</strong><br><br>

                            I'm Coach Manlaw‚Äîand I see you. You're trading time for money, building someone else's dream, feeling the weight of the paycheck trap.
                            You know there's more, but the path from <strong>employee to entrepreneur</strong> feels unclear, risky, maybe even impossible.<br><br>

                            Let me be clear: <strong>This isn't just a career change. It's a complete identity shift.</strong><br>
                            It's about unlearning dependency and rediscovering self-agency. Moving from surviving on a paycheck to creating value, systems, and legacy.<br><br>

                            <strong>üåç THE 7-STAGE TRANSFORMATION JOURNEY: From Employee to Entrepreneur</strong><br><br>

                            I'll guide you through <strong>7 transformational stages</strong>, built on the <strong>4 Legs of Your Billion-Dollar Table</strong>.
                            Your success depends on your weakest leg‚Äîand we're strengthening ALL of them:<br><br>

                            <strong style="color: #FFD700; font-size: 1.1rem;">üß† MINDSET MYSTERY</strong> - <em>Awakening & Reprogramming Your Mind</em><br>
                            <strong>Stage 1: Awakening</strong> ‚Äì "I'm not building my dream. I'm helping someone else build theirs."<br>
                            ‚Üí Realize the trap. Recognize job security is an illusion. Hard work alone won't create freedom.<br>
                            ‚Üí Focus: <em>Awareness ‚Üí Financial self-realization</em><br><br>

                            <strong>Stage 2: Reprogramming</strong> ‚Äì "If I don't change my thinking, I'll repeat the same cycle."<br>
                            ‚Üí Unlearn employee habits (fear, dependency, trading time for money). Reprogram for growth, risk, leadership.<br>
                            ‚Üí Focus: <em>Unlearning ‚Üí Building a Money Mindset</em><br><br>

                            <strong style="color: #FFD700; font-size: 1.1rem;">üí∏ MONEY MOVES</strong> - <em>From Value Discovery to First Income</em><br>
                            <strong>Stage 3: Discovery</strong> ‚Äì "What do I have that can solve problems or create value?"<br>
                            ‚Üí Identify your purpose, passions, strengths. Find your profitable niche‚Äîyour true path as a value creator.<br>
                            ‚Üí Focus: <em>Self-awareness ‚Üí Profitable purpose</em><br><br>

                            <strong>Stage 4: Activation</strong> ‚Äì "Done is better than perfect. Action creates clarity."<br>
                            ‚Üí Test ideas through small offers or side hustles. Learn by doing. Overcome fear through execution.<br>
                            ‚Üí Focus: <em>Action ‚Üí First income stream</em><br><br>

                            <strong style="color: #FFD700; font-size: 1.1rem;">‚öôÔ∏è LEGACY MISSIONS</strong> - <em>Building Systems That Work For You</em><br>
                            <strong>Stage 5: Systemization</strong> ‚Äì "I don't want to work harder‚ÄîI want to build a system that works for me."<br>
                            ‚Üí Move from hustling to structuring. Build systems, automations, processes that create leverage and consistency.<br>
                            ‚Üí Focus: <em>Self-employment ‚Üí Business ownership</em><br><br>

                            <strong style="color: #FFD700; font-size: 1.1rem;">üåç MOMENTUM MOVEMENT</strong> - <em>From Solo Success to Generational Impact</em><br>
                            <strong>Stage 6: Expansion</strong> ‚Äì "I grow by helping others grow."<br>
                            ‚Üí Shift from working IN the business to working ON it. Build teams, collaborations, communities that multiply your impact.<br>
                            ‚Üí Focus: <em>Leadership ‚Üí Community growth</em><br><br>

                            <strong>Stage 7: Legacy</strong> ‚Äì "My purpose is to create systems that outlive me."<br>
                            ‚Üí Transcend personal success. Focus on generational impact, mentorship, contribution.<br>
                            ‚Üí Focus: <em>Purpose-driven leadership ‚Üí Legacy creation</em><br><br>

                            <strong>üìä YOUR BILLIONAIRE TABLE FRAMEWORK:</strong><br>
                            <strong>üß† Mindset Mystery</strong> - Transform identity & beliefs (Stages 1-2)<br>
                            <strong>üí∏ Money Moves</strong> - Build wealth systems that work while you sleep (Stages 3-4)<br>
                            <strong>‚öôÔ∏è Legacy Missions</strong> - Create scalable systems & automation (Stage 5)<br>
                            <strong>üåç Momentum Movement</strong> - Build influence & lead movements (Stages 6-7)<br><br>

                            <em>"As a man thinks, so is he"</em> (Proverbs 23:7). But thinking without action is just dreaming.
                            We're building <strong>systems, movements, and money machines</strong>.<br><br>

                            <em>"I am a Legacy Builder, You are a Legacy Builder, and Together we are Builders of Legacies."</em><br><br>

                            <strong>Your First Step:</strong> Take your BTSS (Billion-Dollar Table Stability Score) assessment.
                            I'll identify which stage you're in, which leg is weakest, and exactly where to focus your transformation.<br><br>

                            Or just ask me anything‚ÄîI'm here 24/7 to coach you through this journey. <strong>Let's transform you from employee to entrepreneur!</strong> üí™üî•
                        </div>
                        <div class="message-time" id="welcomeTime">Just now</div>
                        <div style="margin-top: 1rem;">
                            <button onclick="playIntroductionAudio()" class="sidebar-btn" style="width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--success), var(--purple)); font-weight: 600;">
                                <i class="fas fa-volume-up"></i> Listen to Introduction (Luke)
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 90-Day Lesson Overview -->
                <div class="message coach" style="margin-top: 2rem;">
                    <div class="message-avatar">üìö</div>
                    <div class="message-content">
                        <div class="message-text">
                            <strong style="font-size: 1.3rem; color: var(--gold);">üìñ YOUR 90-DAY TRANSFORMATION ROADMAP</strong><br><br>

                            <p style="opacity: 0.9; margin-bottom: 1.5rem;">
                                Below is your complete journey‚Äîall 90 lessons that will transform you from employee to entrepreneur.
                                <strong>Lessons are unlocked sequentially</strong> as you complete them. Stay disciplined, follow the path, and trust the process.
                            </p>

                            <div style="margin-bottom: 1rem;">
                                <button onclick="readAllLessons()" class="sidebar-btn" style="width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--gold), var(--orange)); font-weight: 600;">
                                    <i class="fas fa-headphones"></i> Luke Reads All 90 Lessons
                                </button>
                            </div>

                            <div id="lessonOverviewContainer">
                                <!-- Lesson overview will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="typing-indicator" id="typingIndicator">
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                    <span class="typing-dot"></span>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="quick-actions" id="quickActions">
                    <button class="quick-action-btn" onclick="viewLesson()">
                        üìñ Today's Lesson
                    </button>
                    <button class="quick-action-btn" onclick="viewLesson()">
                        üéØ Today's Activity
                    </button>
                    <button class="quick-action-btn" onclick="openAssessment()">
                        üí° Take Assessment
                    </button>
                    <button class="quick-action-btn" onclick="showProgress()">
                        üìä My Progress
                    </button>
                    <button class="quick-action-btn" onclick="show90DayList()">
                        üìö 90-Day Content List
                    </button>
                </div>

                <div class="input-container">
                    <input type="text" class="chat-input" id="messageInput" placeholder="Ask Coach Manlaw anything..."
                        onkeypress="handleKeyPress(event)">
                    <button class="btn-send" id="sendBtn" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Journal Modal -->
    <div class="modal-overlay" id="journalModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-book-open"></i> Your Transformation Journal</h3>
                <button class="btn-close" onclick="closeJournal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="assessment-item" style="background: linear-gradient(135deg, rgba(76, 236, 196, 0.15), rgba(155, 89, 182, 0.15)); border-left: 4px solid var(--success);">
                <p style="margin: 0; opacity: 0.9; line-height: 1.6;">
                    <strong>üìñ Your Complete Journey Record</strong><br>
                    All your activities, assignments, and personal reflections from your 90-day transformation. This is your legacy document.
                </p>
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button type="button" onclick="downloadJournal()" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--gold), var(--orange)); padding: 1rem; font-weight: 600;">
                        <i class="fas fa-download"></i> Download Journal
                    </button>
                    <button type="button" onclick="clearJournal()" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, rgba(255,0,0,0.6), rgba(150,0,0,0.6)); padding: 1rem; font-weight: 600;">
                        <i class="fas fa-trash"></i> Clear Journal
                    </button>
                </div>
            </div>

            <div id="journalEntriesContainer" style="max-height: 60vh; overflow-y: auto;">
                <!-- Journal entries will be populated here -->
            </div>
        </div>
    </div>

    <!-- BTSS Assessment Modal -->
    <div class="modal-overlay" id="assessmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-clipboard-check"></i> BTSS Assessment</h3>
                <button class="btn-close" onclick="closeAssessment()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- BTSS Explanation Section -->
            <div style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(255, 107, 53, 0.15)); padding: 1.5rem; border-radius: 12px; border-left: 4px solid var(--gold); margin-bottom: 2rem;">
                <h4 style="color: var(--gold); margin: 0 0 1rem 0; font-size: 1.1rem;">
                    <i class="fas fa-info-circle"></i> What is BTSS?
                </h4>
                <p style="color: var(--white); opacity: 0.95; margin-bottom: 1rem; line-height: 1.6;">
                    <strong>BTSS = Billion-Dollar Table Stability Score</strong><br>
                    Your empire is a table. It stands on 4 legs. If one leg is weak, the whole table wobbles‚Äîno matter how strong the others are. BTSS measures the stability of your table by assessing all four legs.
                </p>

                <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <p style="color: var(--gold); font-weight: 600; margin: 0 0 0.5rem 0; font-size: 0.95rem;">
                        <i class="fas fa-table"></i> The 4 Legs of Your Billion-Dollar Table:
                    </p>
                    <ul style="color: var(--white); opacity: 0.9; margin: 0; padding-left: 1.5rem; line-height: 1.8; font-size: 0.9rem;">
                        <li><strong>üß† Mindset Mystery:</strong> Your beliefs, vision, spiritual alignment, mental wealth</li>
                        <li><strong>üí∏ Money Moves:</strong> Financial intelligence, income streams, wealth multiplication</li>
                        <li><strong>‚öôÔ∏è Legacy Missions:</strong> Scalable systems, automation, purpose-driven business</li>
                        <li><strong>üåç Momentum Movement:</strong> Impact, influence, community building, leadership</li>
                    </ul>
                </div>

                <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                    <p style="color: var(--orange); font-weight: 600; margin: 0 0 0.5rem 0; font-size: 0.95rem;">
                        <i class="fas fa-chart-line"></i> How to Rate Yourself (0-100):
                    </p>
                    <table style="width: 100%; color: var(--white); font-size: 0.85rem; border-collapse: collapse;">
                        <tr style="background: rgba(255,255,255,0.05);">
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1); font-weight: 600;">0-20</td>
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1);">
                                <strong style="color: var(--danger);">Broken:</strong> No foundation. Starting from scratch. Need urgent attention.
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1); font-weight: 600;">21-40</td>
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1);">
                                <strong style="color: var(--orange);">Weak:</strong> Some awareness, but no systems. Struggling and inconsistent.
                            </td>
                        </tr>
                        <tr style="background: rgba(255,255,255,0.05);">
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1); font-weight: 600;">41-60</td>
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1);">
                                <strong style="color: var(--gold);">Developing:</strong> Basic foundation. Learning and growing, but not yet consistent.
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1); font-weight: 600;">61-80</td>
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1);">
                                <strong style="color: var(--success);">Strong:</strong> Solid systems. Consistent results. Growing steadily.
                            </td>
                        </tr>
                        <tr style="background: rgba(255,255,255,0.05);">
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1); font-weight: 600;">81-100</td>
                            <td style="padding: 0.5rem; border: 1px solid rgba(255,255,255,0.1);">
                                <strong style="color: var(--purple);">Elite:</strong> Mastery level. Systems run without you. Multiplying impact.
                            </td>
                        </tr>
                    </table>
                </div>

                <p style="color: var(--white); opacity: 0.85; margin: 1rem 0 0 0; font-size: 0.85rem; font-style: italic;">
                    <i class="fas fa-lightbulb"></i> <strong>Remember:</strong> Be brutally honest. Your weakest leg determines your table's stability‚Äîand your growth potential!
                </p>
            </div>

            <div class="assessment-form" id="assessmentForm">
                <div class="assessment-item">
                    <h4>üß† Mindset Mystery</h4>
                    <p style="margin-bottom: 0.5rem;">Your beliefs, vision, spiritual alignment, and mental wealth</p>
                    <details style="margin-bottom: 1rem;">
                        <summary style="cursor: pointer; color: var(--gold); font-size: 0.85rem; opacity: 0.8;">
                            <i class="fas fa-question-circle"></i> How to rate this?
                        </summary>
                        <div style="padding: 0.8rem; background: rgba(0,0,0,0.2); border-radius: 6px; margin-top: 0.5rem; font-size: 0.8rem; line-height: 1.6;">
                            <strong>0-20:</strong> Stuck in employee mindset. No vision. Doubt yourself constantly.<br>
                            <strong>21-40:</strong> Aware you want more, but fear holds you back. No clear vision yet.<br>
                            <strong>41-60:</strong> Starting to think like entrepreneur. Have vision, working on beliefs.<br>
                            <strong>61-80:</strong> Strong mindset. Clear vision. Faith-driven. Still growing.<br>
                            <strong>81-100:</strong> Unshakeable belief. Crystal-clear vision. Spiritual alignment. Unstoppable.
                        </div>
                    </details>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="50" class="slider" id="mindsetSlider">
                        <span class="slider-value" id="mindsetValue">50</span>
                    </div>
                </div>

                <div class="assessment-item">
                    <h4>üí∏ Money Moves</h4>
                    <p style="margin-bottom: 0.5rem;">Financial intelligence, income streams, and wealth multiplication</p>
                    <details style="margin-bottom: 1rem;">
                        <summary style="cursor: pointer; color: var(--gold); font-size: 0.85rem; opacity: 0.8;">
                            <i class="fas fa-question-circle"></i> How to rate this?
                        </summary>
                        <div style="padding: 0.8rem; background: rgba(0,0,0,0.2); border-radius: 6px; margin-top: 0.5rem; font-size: 0.8rem; line-height: 1.6;">
                            <strong>0-20:</strong> One income stream (salary). Living paycheck to paycheck. No savings.<br>
                            <strong>21-40:</strong> Same income, but trying to save. No investment knowledge yet.<br>
                            <strong>41-60:</strong> Starting side income. Learning about money. Building assets slowly.<br>
                            <strong>61-80:</strong> Multiple income streams. Growing investments. Good financial IQ.<br>
                            <strong>81-100:</strong> Passive income exceeds expenses. Money multiplies itself. Financial freedom.
                        </div>
                    </details>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="50" class="slider" id="moneySlider">
                        <span class="slider-value" id="moneyValue">50</span>
                    </div>
                </div>

                <div class="assessment-item">
                    <h4>‚öôÔ∏è Legacy Missions</h4>
                    <p style="margin-bottom: 0.5rem;">Scalable systems, automation, purpose-driven business, and management</p>
                    <details style="margin-bottom: 1rem;">
                        <summary style="cursor: pointer; color: var(--gold); font-size: 0.85rem; opacity: 0.8;">
                            <i class="fas fa-question-circle"></i> How to rate this?
                        </summary>
                        <div style="padding: 0.8rem; background: rgba(0,0,0,0.2); border-radius: 6px; margin-top: 0.5rem; font-size: 0.8rem; line-height: 1.6;">
                            <strong>0-20:</strong> No systems. Everything depends on you. Hustling daily.<br>
                            <strong>21-40:</strong> Aware you need systems, but haven't built any yet. Still trading time for money.<br>
                            <strong>41-60:</strong> Some basic systems. Trying to automate. Still doing most work yourself.<br>
                            <strong>61-80:</strong> Good systems in place. Team handles most tasks. Business runs without you (mostly).<br>
                            <strong>81-100:</strong> Fully automated. Business runs without you. Scalable and duplicatable systems.
                        </div>
                    </details>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="50" class="slider" id="legacySlider">
                        <span class="slider-value" id="legacyValue">50</span>
                    </div>
                </div>

                <div class="assessment-item">
                    <h4>üåç Momentum Movement</h4>
                    <p style="margin-bottom: 0.5rem;">Impact, influence, community building, and leadership</p>
                    <details style="margin-bottom: 1rem;">
                        <summary style="cursor: pointer; color: var(--gold); font-size: 0.85rem; opacity: 0.8;">
                            <i class="fas fa-question-circle"></i> How to rate this?
                        </summary>
                        <div style="padding: 0.8rem; background: rgba(0,0,0,0.2); border-radius: 6px; margin-top: 0.5rem; font-size: 0.8rem; line-height: 1.6;">
                            <strong>0-20:</strong> No network. Working alone. No influence. Nobody follows your lead.<br>
                            <strong>21-40:</strong> Small circle. Trying to network. Minimal influence. Inconsistent leadership.<br>
                            <strong>41-60:</strong> Growing community. Some influence. People listen. Building leadership skills.<br>
                            <strong>61-80:</strong> Strong network. Clear influence. Leading teams. Creating impact beyond yourself.<br>
                            <strong>81-100:</strong> Movement builder. Massive influence. Leading leaders. Generational impact. Legacy in motion.
                        </div>
                    </details>
                    <div class="slider-container">
                        <input type="range" min="0" max="100" value="50" class="slider" id="movementSlider">
                        <span class="slider-value" id="movementValue">50</span>
                    </div>
                </div>

                <div class="btn-submit" id="submitAssessmentBtn" style="cursor: pointer; user-select: none;">
                    <i class="fas fa-check"></i> Submit Assessment
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> AI Settings</h3>
                <button class="btn-close" onclick="closeSettings()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="assessment-item">
                <h4>AI API Key</h4>
                <p>Enter your API key to enable AI coaching</p>
                <input type="password" id="claudeKey" placeholder="Enter API key..."
                    style="width: 100%; padding: 1rem; border-radius: 10px; border: 2px solid var(--gold); background: rgba(255,255,255,0.1); color: white;">
            </div>

            <div class="assessment-item">
                <h4>AI Model</h4>
                <select id="aiModel"
                    style="width: 100%; padding: 1rem; border-radius: 10px; border: 2px solid var(--gold); background: rgba(255,255,255,0.1); color: white;">
                    <option value="claude-sonnet-4-20250514">Advanced Model (Recommended)</option>
                    <option value="gpt-4">Alternative Model</option>
                </select>
            </div>

            <button type="button" class="btn-submit" onclick="saveSettings()">
                <i class="fas fa-save"></i> Save Settings
            </button>
        </div>
    </div>

    <!-- Activity Center Modal -->
    <div class="modal-overlay" id="activityModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3><i class="fas fa-tasks"></i> Activity Center</h3>
                <button class="btn-close" onclick="closeActivity()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <p style="color: var(--white); opacity: 0.9; margin-bottom: 2rem;">
                Complete daily activities, respond to assignments, and track your engagement with Coach Manlaw's curriculum.
            </p>

            <div class="assessment-item">
                <h4><i class="fas fa-fire"></i> Today's Activity</h4>
                <div style="background: rgba(255, 107, 53, 0.1); padding: 1.5rem; border-radius: 10px; border-left: 4px solid var(--royal-gold); margin-bottom: 1.5rem;">
                    <h5 style="color: var(--royal-gold); margin-bottom: 0.8rem;" id="activityTitle">Daily Reflection: Your Current Table Stability</h5>
                    <p style="color: var(--white); line-height: 1.8; margin-bottom: 1rem;" id="activityDescription">
                        Reflect on your Four Legs Table. Which leg is your weakest right now, and what specific action will you take this week to strengthen it?
                    </p>
                    <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,215,0,0.2);">
                        <div style="flex: 1;">
                            <small style="color: var(--royal-gold); display: block; margin-bottom: 0.3rem;">Estimated Time</small>
                            <span style="color: var(--white);" id="activityTime">5-10 minutes</span>
                        </div>
                        <div style="flex: 1;">
                            <small style="color: var(--royal-gold); display: block; margin-bottom: 0.3rem;">AI Fuel Cost</small>
                            <span style="color: var(--white);" id="activityFuel">2 fuel</span>
                        </div>
                        <div style="flex: 1;">
                            <small style="color: var(--royal-gold); display: block; margin-bottom: 0.3rem;">Status</small>
                            <span style="color: #00ff88; font-weight: 600;" id="activityStatus">Active</span>
                        </div>
                    </div>
                </div>

                <div id="activityResponseSection">
                    <label style="color: var(--royal-gold); font-weight: 600; margin-bottom: 0.5rem; display: block;">
                        <i class="fas fa-pencil-alt"></i> Your Response
                    </label>
                    <textarea id="activityResponseInput" placeholder="Type your thoughtful response here... Coach Manlaw will provide personalized feedback."
                        style="width: 100%; min-height: 150px; padding: 1rem; border: 2px solid var(--royal-gold); border-radius: 12px; background: rgba(0,0,0,0.3); color: white; font-family: inherit; font-size: 0.95rem; resize: vertical; margin-bottom: 1rem;"></textarea>

                    <button type="button" onclick="submitActivityResponse()" class="btn-submit" style="width: 100%; background: linear-gradient(135deg, var(--royal-gold), var(--royal-gold-light)); padding: 1rem; font-weight: 600;">
                        <i class="fas fa-paper-plane"></i> Submit to Coach Manlaw
                    </button>
                </div>
            </div>

            <div class="assessment-item" style="margin-top: 2rem;">
                <h4><i class="fas fa-history"></i> Recent Activities</h4>
                <div id="activityHistory">
                    <div style="background: rgba(30, 58, 138, 0.3); padding: 1rem; border-radius: 10px; margin-bottom: 0.8rem; border-left: 3px solid #00ff88;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <span style="color: var(--royal-gold); font-weight: 600;">Week 1, Day 1: Breaking the Employee Mindset</span>
                            <span style="color: #00ff88; font-size: 0.85rem;"><i class="fas fa-check-circle"></i> Completed</span>
                        </div>
                        <p style="color: var(--white); opacity: 0.8; font-size: 0.9rem; margin: 0;">Submitted 2 days ago</p>
                    </div>
                    <div style="background: rgba(30, 58, 138, 0.3); padding: 1rem; border-radius: 10px; margin-bottom: 0.8rem; border-left: 3px solid #00ff88;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                            <span style="color: var(--royal-gold); font-weight: 600;">Week 1, Day 2: Vision Alignment Exercise</span>
                            <span style="color: #00ff88; font-size: 0.85rem;"><i class="fas fa-check-circle"></i> Completed</span>
                        </div>
                        <p style="color: var(--white); opacity: 0.8; font-size: 0.9rem; margin: 0;">Submitted 1 day ago</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lesson Detail Modal -->
    <div class="modal-overlay" id="lessonModal">
        <div class="modal-content">
            <div class="modal-header">
                <div>
                    <div style="font-size: 0.85rem; color: var(--orange); margin-bottom: 0.3rem;" id="modalLessonWeek">WEEK 1 ‚Ä¢ DAY 1</div>
                    <h3 id="modalLessonTitle">The Employee Trap: Why You're Stuck</h3>
                </div>
                <button class="btn-close" onclick="closeLessonModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Current Stage Tracker (In Modal) -->
            <div class="assessment-item" style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 107, 53, 0.15)); border: 2px solid var(--gold);">
                <div style="text-align: center;">
                    <div style="font-size: 0.9rem; font-weight: 600; color: var(--orange); margin-bottom: 0.5rem;"><i class="fas fa-rocket"></i> YOUR TRANSFORMATION STAGE</div>
                    <div style="font-size: 1.5rem; font-weight: 800; color: var(--gold); margin-bottom: 0.2rem;" id="modalStageNumber">Stage 1</div>
                    <div style="font-size: 1rem; font-weight: 600; color: var(--white); margin-bottom: 0.2rem;" id="modalStageName">Awakening</div>
                    <div style="font-size: 0.85rem; color: var(--gold); font-weight: 500; font-style: italic; margin-bottom: 0.4rem;" id="modalStageSubtitle"></div>
                    <div style="font-size: 0.8rem; color: var(--orange); font-weight: 500;" id="modalStageLeg">üß† Mindset Mystery</div>
                </div>
            </div>

            <!-- Stage Overview with Details -->
            <div class="assessment-item" id="stageOverviewPanel" style="background: linear-gradient(135deg, rgba(76, 236, 196, 0.1), rgba(155, 89, 182, 0.1)); border-left: 4px solid var(--purple);">
                <h4 style="color: var(--gold); margin-bottom: 1rem;"><i class="fas fa-map-marked-alt"></i> Stage Overview</h4>
                <div id="stageOverviewContent">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <div class="assessment-item">
                <h4><i class="fas fa-book"></i> Lesson</h4>
                <p id="modalLessonContent" style="white-space: pre-line;">
                    Understanding the psychological chains of employment...
                </p>
            </div>

            <!-- Comprehension Check -->
            <div class="assessment-item" style="background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(255, 107, 53, 0.1)); border-left: 4px solid var(--gold);">
                <h4><i class="fas fa-brain"></i> Comprehension Check</h4>
                <p style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 1rem;">
                    Answer these 5 questions to ensure you've grasped today's lesson. Understanding comes before action.
                </p>
                <div id="comprehensionQuestions">
                    <!-- Questions will be populated by JavaScript -->
                </div>
                <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                    <button type="button" onclick="checkComprehension()" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--gold), var(--orange)); padding: 1rem; font-weight: 600;">
                        <i class="fas fa-check-circle"></i> Check Answers
                    </button>
                    <button type="button" onclick="saveToJournal('comprehension')" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--purple), var(--success)); padding: 1rem; font-weight: 600;">
                        <i class="fas fa-save"></i> Save to Journal
                    </button>
                </div>
                <div id="comprehensionFeedback" style="display: none; margin-top: 1rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(76, 236, 196, 0.15), rgba(155, 89, 182, 0.15)); border-left: 4px solid var(--success); border-radius: 12px;">
                    <h5 style="margin: 0 0 0.8rem 0; color: var(--gold); font-size: 1rem;"><i class="fas fa-trophy"></i> Results</h5>
                    <p id="comprehensionFeedbackText" style="margin: 0; line-height: 1.6; color: rgba(255,255,255,0.9);"></p>
                </div>
            </div>

            <div class="assessment-item">
                <h4><i class="fas fa-play-circle"></i> Activity</h4>
                <p id="modalLessonActivity">
                    Write down 5 employee beliefs holding you back...
                </p>
                <div id="activityResponseSection" style="margin-top: 1rem;">
                    <textarea id="activityResponseInput" placeholder="üìù Type your activity response here... This will be saved to your journal." style="width: 100%; min-height: 150px; padding: 1rem; border: 2px solid var(--purple); border-radius: 12px; background: rgba(0,0,0,0.3); color: white; font-family: inherit; font-size: 0.95rem; resize: vertical;"></textarea>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.8rem;">
                        <button type="button" onclick="saveToJournal('activity')" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--purple), var(--success)); padding: 1rem; font-weight: 600;">
                            <i class="fas fa-save"></i> Save to Journal
                        </button>
                        <button type="button" onclick="submitActivityResponse()" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--orange), var(--gold)); padding: 1rem; font-weight: 600;">
                            <i class="fas fa-paper-plane"></i> Submit to Coach
                        </button>
                    </div>
                    <div id="activityFeedback" style="display: none; margin-top: 1rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(76, 236, 196, 0.15), rgba(155, 89, 182, 0.15)); border-left: 4px solid var(--purple); border-radius: 12px;">
                        <h5 style="margin: 0 0 0.8rem 0; color: var(--gold); font-size: 1rem;"><i class="fas fa-comments"></i> Coach ManLaw Says:</h5>
                        <p id="activityFeedbackText" style="margin: 0; line-height: 1.6; color: rgba(255,255,255,0.9);"></p>
                    </div>
                </div>
            </div>

            <div class="assessment-item">
                <h4><i class="fas fa-clipboard-list"></i> Assignment</h4>
                <p id="modalLessonAssignment">
                    BTSS Assessment - Baseline measurement...
                </p>
                <div id="assignmentResponseSection" style="margin-top: 1rem;">
                    <textarea id="assignmentResponseInput" placeholder="üìù Type your assignment response here... This will be saved to your journal." style="width: 100%; min-height: 150px; padding: 1rem; border: 2px solid var(--orange); border-radius: 12px; background: rgba(0,0,0,0.3); color: white; font-family: inherit; font-size: 0.95rem; resize: vertical;"></textarea>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.8rem;">
                        <button type="button" onclick="saveToJournal('assignment')" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--purple), var(--success)); padding: 1rem; font-weight: 600;">
                            <i class="fas fa-save"></i> Save to Journal
                        </button>
                        <button type="button" onclick="submitAssignmentResponse()" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--gold), var(--orange)); padding: 1rem; font-weight: 600;">
                            <i class="fas fa-paper-plane"></i> Submit to Coach
                        </button>
                    </div>
                    <div id="assignmentFeedback" style="display: none; margin-top: 1rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(255, 107, 53, 0.15), rgba(212, 175, 55, 0.15)); border-left: 4px solid var(--orange); border-radius: 12px;">
                        <h5 style="margin: 0 0 0.8rem 0; color: var(--gold); font-size: 1rem;"><i class="fas fa-comments"></i> Coach ManLaw Says:</h5>
                        <p id="assignmentFeedbackText" style="margin: 0; line-height: 1.6; color: rgba(255,255,255,0.9);"></p>
                    </div>
                </div>
            </div>

            <!-- Personal Notes / Journal Section -->
            <div class="assessment-item" style="background: linear-gradient(135deg, rgba(155, 89, 182, 0.15), rgba(76, 236, 196, 0.15)); border-left: 4px solid var(--success);">
                <h4><i class="fas fa-pen-fancy"></i> Personal Notes & Reflections</h4>
                <p style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 1rem;">
                    Capture your thoughts, insights, and reflections from today's lesson. All entries are automatically saved to your journal.
                </p>
                <textarea id="personalNotesInput" placeholder="‚úçÔ∏è Write your thoughts, breakthroughs, questions, or reflections here..." style="width: 100%; min-height: 150px; padding: 1rem; border: 2px solid var(--success); border-radius: 12px; background: rgba(0,0,0,0.3); color: white; font-family: inherit; font-size: 0.95rem; resize: vertical;"></textarea>
                <div style="display: flex; gap: 0.5rem; margin-top: 0.8rem;">
                    <button type="button" onclick="saveToJournal('notes')" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--success), var(--purple)); padding: 1rem; font-weight: 600;">
                        <i class="fas fa-save"></i> Save Notes to Journal
                    </button>
                    <button type="button" onclick="viewJournal()" class="sidebar-btn" style="flex: 1; background: linear-gradient(135deg, var(--gold), var(--orange)); padding: 1rem; font-weight: 600;">
                        <i class="fas fa-book-open"></i> View Full Journal
                    </button>
                </div>
            </div>

            <div class="assessment-item" id="modalAppConnection" style="display: none; background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(212, 175, 55, 0.1));">
                <h4><i class="fas fa-link"></i> Recommended App</h4>
                <p><strong id="modalAppName">ZYRO</strong></p>
                <p id="modalAppHow" style="font-size: 0.9rem;">Use ZYRO's challenges to practice...</p>
            </div>

            <!-- Learning Mode Selector -->
            <div class="assessment-item" style="background: linear-gradient(135deg, rgba(76, 236, 196, 0.1), rgba(155, 89, 182, 0.1));">
                <h4><i class="fas fa-brain"></i> Learning Mode</h4>
                <p style="font-size: 0.85rem; margin-bottom: 1rem;">Choose how you want to experience this lesson:</p>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.8rem;">
                    <button type="button" class="sidebar-btn" id="modeRead" onclick="setLearningMode('read')" style="padding: 0.8rem; font-size: 0.85rem;">
                        <i class="fas fa-book"></i><br>Read
                    </button>
                    <button type="button" class="sidebar-btn" id="modeListen" onclick="setLearningMode('listen')" style="padding: 0.8rem; font-size: 0.85rem;">
                        <i class="fas fa-headphones"></i><br>Listen
                    </button>
                    <button type="button" class="sidebar-btn" id="modeWatch" onclick="setLearningMode('watch')" style="padding: 0.8rem; font-size: 0.85rem;">
                        <i class="fas fa-video"></i><br>Watch
                    </button>
                </div>
            </div>

            <!-- Audio Player (for Listen mode) -->
            <div class="assessment-item" id="audioPlayer" style="display: none; background: linear-gradient(135deg, rgba(76, 236, 196, 0.15), rgba(155, 89, 182, 0.15));">
                <h4><i class="fas fa-volume-up"></i> Audio Lesson - Listen Mode</h4>
                <p style="font-size: 0.85rem; opacity: 0.9; margin-bottom: 1rem;">
                    <i class="fas fa-headphones"></i> Read along while listening! Audio will narrate the lesson below. Perfect for multitasking or reinforcing learning!
                </p>

                <div style="display: flex; align-items: center; gap: 1rem; margin-top: 1rem;">
                    <button type="button" id="playPauseBtn" onclick="toggleAudio()" style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, var(--success), var(--purple)); border: none; color: white; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 15px rgba(76, 236, 196, 0.4); transition: all 0.3s;">
                        <i class="fas fa-play"></i>
                    </button>
                    <div style="flex: 1;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <div style="font-size: 0.85rem; opacity: 0.8;" id="audioProgress">Ready to play</div>
                            <div style="font-size: 0.85rem; opacity: 0.8; font-weight: 600; color: var(--gold);" id="audioTime">0:00 / 0:00</div>
                        </div>
                        <div class="bar-container" onclick="seekAudio(event)" style="cursor: pointer; height: 8px; position: relative;" title="Click to seek">
                            <div class="bar-fill" id="audioProgressBar" style="width: 0%; background: linear-gradient(90deg, var(--success), var(--purple)); transition: width 0.1s linear; height: 100%; border-radius: 4px;"></div>
                            <div id="audioProgressHandle" style="position: absolute; top: 50%; right: 0; transform: translate(50%, -50%); width: 14px; height: 14px; background: white; border-radius: 50%; box-shadow: 0 2px 6px rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s;"></div>
                        </div>
                    </div>
                    <button type="button" onclick="stopAudio()" style="width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1); border: none; color: white; cursor: pointer; transition: all 0.3s;" title="Stop playback">
                        <i class="fas fa-stop"></i>
                    </button>
                </div>

                <!-- Speed Control -->
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.85rem;"><i class="fas fa-tachometer-alt"></i> Playback Speed:</span>
                        <span id="speedDisplay" style="font-weight: 600; color: var(--gold);">1.0x</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 0.5rem;">
                        <button onclick="setAudioSpeed(0.75)" style="padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 0.75rem; cursor: pointer;">0.75x</button>
                        <button onclick="setAudioSpeed(0.9)" style="padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 0.75rem; cursor: pointer;">0.9x</button>
                        <button onclick="setAudioSpeed(1.0)" style="padding: 0.5rem; background: linear-gradient(135deg, var(--gold), var(--orange)); border: none; border-radius: 6px; color: var(--navy-blue); font-size: 0.75rem; font-weight: 600; cursor: pointer;">1.0x</button>
                        <button onclick="setAudioSpeed(1.25)" style="padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 0.75rem; cursor: pointer;">1.25x</button>
                        <button onclick="setAudioSpeed(1.5)" style="padding: 0.5rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; color: white; font-size: 0.75rem; cursor: pointer;">1.5x</button>
                    </div>
                </div>

                <p style="font-size: 0.8rem; opacity: 0.7; margin-top: 1rem;">
                    <i class="fas fa-lightbulb"></i> <strong>Pro Tip:</strong> Read along with the audio for better retention, or just listen while you work, drive, or exercise!
                </p>
            </div>

            <!-- Video/Animation View (for Watch mode) -->
            <div class="assessment-item" id="videoPlayer" style="display: none; background: rgba(0,0,0,0.3);">
                <!-- AI Video Lesson Option -->
                <div id="videoGenerateSection" style="background: linear-gradient(135deg, rgba(255, 107, 53, 0.2), rgba(212, 175, 55, 0.2)); padding: 1.5rem; border-radius: 10px; margin-bottom: 1rem;">
                    <h4 style="color: var(--gold); margin-bottom: 0.8rem;">
                        <i class="fas fa-video"></i> AI Video Lesson (VIDZIE)
                    </h4>
                    <p style="font-size: 0.9rem; margin-bottom: 1rem; opacity: 0.9;">
                        Generate a professional talking avatar video of this lesson with Coach Manlaw's voice! <br>
                        <span style="font-size: 0.85rem; color: var(--gold);">
                            <i class="fas fa-star"></i> Stage-aware video includes your transformation stage context
                        </span>
                    </p>
                    <button type="button" onclick="generateCoachingVideo()" id="btnGenerateCoachVideo" style="width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--gold), var(--orange)); border: none; border-radius: 10px; color: var(--navy-blue); font-weight: 700; cursor: pointer;">
                        <i class="fas fa-magic"></i> Generate Video Lesson
                    </button>
                    <div id="videoGenerationProgress" style="display: none; margin-top: 1rem;">
                        <div style="font-size: 0.9rem; margin-bottom: 0.5rem; text-align: center;">
                            <i class="fas fa-spinner fa-spin"></i> Generating your video lesson...
                        </div>
                        <div class="bar-container">
                            <div class="bar-fill" id="videoGenProgressBar" style="width: 0%; background: linear-gradient(90deg, var(--gold), var(--orange));"></div>
                        </div>
                        <p style="font-size: 0.85rem; opacity: 0.7; margin-top: 0.5rem; text-align: center;">
                            This usually takes 10-30 seconds...
                        </p>
                    </div>
                </div>

                <!-- Generated Video Player -->
                <div id="generatedVideoSection" style="display: none; margin-bottom: 1rem;">
                    <video id="coachingVideoPlayer" controls style="width: 100%; border-radius: 10px; background: black;">
                        <source id="videoSource" type="video/mp4">
                    </video>
                    <div style="display: flex; gap: 0.8rem; margin-top: 1rem;">
                        <button type="button" onclick="downloadCoachingVideo()" style="flex: 1; padding: 0.8rem; background: linear-gradient(135deg, var(--success), var(--purple)); border: none; border-radius: 10px; color: white; font-weight: 600; cursor: pointer;">
                            <i class="fas fa-download"></i> Download
                        </button>
                        <button type="button" onclick="shareCoachingVideo()" style="flex: 1; padding: 0.8rem; background: linear-gradient(135deg, var(--gold), var(--orange)); border: none; border-radius: 10px; color: var(--navy-blue); font-weight: 600; cursor: pointer;">
                            <i class="fas fa-share"></i> Share
                        </button>
                    </div>
                </div>

                <!-- Animated Slides (fallback) -->
                <div id="animatedLesson" style="min-height: 300px; padding: 2rem; text-align: center; position: relative; overflow: hidden;">
                    <!-- Animated content will be inserted here -->
                </div>
                <div style="display: flex; gap: 0.8rem; margin-top: 1rem;">
                    <button type="button" onclick="restartAnimation()" style="flex: 1; padding: 0.8rem; background: rgba(255,255,255,0.1); border: none; border-radius: 10px; color: white; cursor: pointer;">
                        <i class="fas fa-redo"></i> Restart Animation
                    </button>
                    <button type="button" onclick="pauseAnimation()" id="pauseAnimBtn" style="flex: 1; padding: 0.8rem; background: rgba(255,255,255,0.1); border: none; border-radius: 10px; color: white; cursor: pointer;">
                        <i class="fas fa-pause"></i> Pause
                    </button>
                </div>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="button" class="btn-submit" style="flex: 1; background: rgba(255,255,255,0.1); color: white;" onclick="previousDay()">
                    <i class="fas fa-chevron-left"></i> Previous Day
                </button>
                <button type="button" class="btn-submit" style="flex: 1;" onclick="completeLesson()">
                    <i class="fas fa-check"></i> Mark Complete
                </button>
                <button type="button" class="btn-submit" style="flex: 1; background: rgba(255,255,255,0.1); color: white;" onclick="nextDay()">
                    Next Day <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Progress Dashboard Modal -->
    <div class="modal-overlay" id="progressModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3><i class="fas fa-chart-line"></i> 90-Day Progress Dashboard</h3>
                <button class="btn-close" onclick="closeProgress()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="assessment-item">
                <h4>Overall Journey</h4>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: var(--gold); font-weight: bold;" id="progressDay">1</div>
                        <div style="font-size: 0.85rem; opacity: 0.8;">Day of 90</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: var(--orange); font-weight: bold;" id="progressPercent">1%</div>
                        <div style="font-size: 0.85rem; opacity: 0.8;">Complete</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; color: var(--success); font-weight: bold;" id="progressCompleted">0</div>
                        <div style="font-size: 0.85rem; opacity: 0.8;">Lessons Done</div>
                    </div>
                </div>
            </div>

            <div class="assessment-item">
                <h4>Phase Progress</h4>
                <div style="margin-top: 1rem;">
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üß† Phase 1: Mindset Mystery</span>
                            <span id="phase1Progress">0%</span>
                        </div>
                        <div class="bar-container">
                            <div class="bar-fill" id="phase1Bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üí∏ Phase 2: Money Moves</span>
                            <span id="phase2Progress">0%</span>
                        </div>
                        <div class="bar-container">
                            <div class="bar-fill" id="phase2Bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>‚öôÔ∏è Phase 3: Legacy Missions</span>
                            <span id="phase3Progress">0%</span>
                        </div>
                        <div class="bar-container">
                            <div class="bar-fill" id="phase3Bar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>üåç Phase 4: Momentum Movement</span>
                            <span id="phase4Progress">0%</span>
                        </div>
                        <div class="bar-container">
                            <div class="bar-fill" id="phase4Bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="assessment-item">
                <h4>BTSS Evolution</h4>
                <p style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem;">
                    Track how each leg has improved since Day 1
                </p>
                <div id="btssHistory" style="font-size: 0.85rem; opacity: 0.9;">
                    No assessment history yet. Take your first BTSS assessment to start tracking!
                </div>
            </div>

            <button type="button" class="btn-submit" onclick="closeProgress()">
                <i class="fas fa-times"></i> Close
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // State
        const currentUserId = 'user_' + (localStorage.getItem('coach_user_id') || Date.now());
        localStorage.setItem('coach_user_id', currentUserId);

        let btssScores = JSON.parse(localStorage.getItem('coach_btss_scores')) || null;
        let btssHistory = JSON.parse(localStorage.getItem('coach_btss_history')) || [];
        let chatHistory = JSON.parse(localStorage.getItem('coach_chat_history')) || [];
        let startDate = localStorage.getItem('coach_start_date') || new Date().toISOString();
        let currentDay = parseInt(localStorage.getItem('coach_current_day')) || 1;
        let completedLessons = JSON.parse(localStorage.getItem('coach_completed_lessons')) || [];
        let curriculum = null;
        let learningMode = localStorage.getItem('coach_learning_mode') || 'read';

        // Audio/Video state
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let isAudioPlaying = false;
        let animationInterval = null;
        let animationPaused = false;

        // Audio timing and progress
        let audioStartTime = 0;
        let audioTotalChars = 0;
        let audioCurrentChar = 0;
        let audioEstimatedDuration = 0;
        let audioProgressInterval = null;

        // User tier management
        let userTier = 'FAM'; // Default to FAM
        function getUserTier() {
            const user = JSON.parse(localStorage.getItem('z2b_current_user') || '{}');
            // Map tier codes to names
            const tierMap = {
                'FREE': 'FAM',
                'STARTER': 'Bronze',
                'PRO': 'Copper',
                'ELITE': 'Silver', // Silver, Gold, Platinum all use ELITE
                'LIFETIME': 'Diamond'
            };
            return tierMap[user.tier] || 'FAM';
        }
        userTier = getUserTier();

        // Tier access functions
        function canAccessLesson(day) {
            if (userTier === 'FAM') {
                return day <= 7; // FAM only gets first 7 lessons
            }
            return true; // All other tiers get all lessons
        }

        function canAccessAudio() {
            // Audio available for Copper and above (Copper,Silver,Gold,Platinum,Diamond)
            return ['Copper', 'Silver', 'Gold', 'Platinum', 'Diamond'].includes(userTier);
        }

        function canAccessVideo() {
            // Video available for Silver and above
            return ['Silver', 'Gold', 'Platinum', 'Diamond'].includes(userTier);
        }

        function showUpgradeNudge(feature, requiredTier) {
            const tierPrices = {
                'Bronze': 'R480/month',
                'Copper': 'R980/month',
                'Silver': 'R1,480/month'
            };

            const message = `
                üîí <strong>${feature} Locked</strong><br><br>
                Upgrade to <strong>${requiredTier}</strong> (${tierPrices[requiredTier] || ''}) or higher to unlock ${feature}!<br><br>
                <strong>Benefits of ${requiredTier}:</strong><br>
                ${requiredTier === 'Bronze' ? '‚Ä¢ Access to Coach Manlaw text lessons<br>‚Ä¢ 100 AI Fuel<br>‚Ä¢ 25% ISP Commission<br>‚Ä¢ 3 Generation TSC' : ''}
                ${requiredTier === 'Copper' ? '‚Ä¢ Audio learning mode<br>‚Ä¢ 200 AI Fuel<br>‚Ä¢ 28% ISP Commission<br>‚Ä¢ 5 Generation TSC' : ''}
                ${requiredTier === 'Silver' ? '‚Ä¢ Video learning mode<br>‚Ä¢ All 4 AI Apps<br>‚Ä¢ 30% ISP Commission<br>‚Ä¢ 7 Generation TSC<br>‚Ä¢ TLI Access' : ''}
            `;

            if (confirm('You need to upgrade to access this feature. Go to Tiers page?')) {
                window.location.href = 'tiers.html';
            }

            addCoachMessage(message);
        }

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            localStorage.setItem('coach_start_date', startDate);
            loadCurriculum();
            loadBTSSScores();
            updateJourneyDay();
            updateCurrentLesson();
            setupSliderListeners();
            loadSettings();
            document.getElementById('welcomeTime').textContent = getCurrentTime();
        });

        // Load curriculum from MANLAW_CURRICULUM
        function loadCurriculum() {
            console.log('üîÑ Attempting to load curriculum...');
            console.log('üîç MANLAW_CURRICULUM exists:', typeof MANLAW_CURRICULUM !== 'undefined');
            if (typeof MANLAW_CURRICULUM !== 'undefined') {
                curriculum = MANLAW_CURRICULUM;
                console.log('‚úÖ Curriculum loaded successfully!');
                console.log('‚úÖ Program name:', curriculum.programName);
                console.log('‚úÖ Phase 1 weeks:', curriculum.phase1_mindset?.weeks?.length);
            } else {
                console.error('‚ùå MANLAW_CURRICULUM not found in window scope!');
                console.error('‚ùå Please check if coach-manlaw-curriculum.js loaded correctly');
                alert('‚ö†Ô∏è Curriculum failed to load. Please refresh the page.');
            }
        }

        // Get lesson by day number
        function getLessonByDay(day) {
            if (!curriculum) return null;

            // Search through all phases
            const phases = [
                curriculum.phase1_mindset,
                curriculum.phase2_money,
                curriculum.phase3_legacy,
                curriculum.phase4_momentum,
                curriculum.finalPhase_integration
            ];

            for (const phase of phases) {
                for (const week of phase.weeks) {
                    for (const lesson of week.lessons) {
                        if (lesson.day === day) {
                            return {
                                ...lesson,
                                week: week.week,
                                theme: week.theme,
                                phaseTitle: phase.title
                            };
                        }
                    }
                }
            }

            return null;
        }

        // Get all lessons (1-90)
        function getAllLessons() {
            if (!curriculum) return [];

            const allLessons = [];
            const phases = [
                curriculum.phase1_mindset,
                curriculum.phase2_money,
                curriculum.phase3_legacy,
                curriculum.phase4_momentum,
                curriculum.finalPhase_integration
            ];

            for (const phase of phases) {
                for (const week of phase.weeks) {
                    for (const lesson of week.lessons) {
                        allLessons.push({
                            ...lesson,
                            week: week.week,
                            theme: week.theme,
                            phaseTitle: phase.title
                        });
                    }
                }
            }

            // Sort by day to ensure correct order
            return allLessons.sort((a, b) => a.day - b.day);
        }

        // Check if a lesson is unlocked
        function isLessonUnlocked(day) {
            // Day 1 is always unlocked
            if (day === 1) return true;

            // A lesson is unlocked if the previous lesson is completed
            return completedLessons.includes(day - 1);
        }

        // Navigate to a specific lesson
        function goToLesson(day) {
            if (!isLessonUnlocked(day)) {
                addCoachMessage(`üîí This lesson is locked! Complete Day ${day - 1} first to unlock it. Stay disciplined‚Äîthe sequence matters for your transformation!`);
                return;
            }

            currentDay = day;
            updateJourneyDay();
            updateCurrentLesson();
            viewLesson();
        }

        // Render the 90-day lesson overview
        function renderLessonOverview() {
            const allLessons = getAllLessons();
            const container = document.getElementById('lessonOverviewContainer');

            if (!container || allLessons.length === 0) return;

            let html = '';
            let currentStage = 0;
            let currentPhase = '';

            allLessons.forEach((lesson) => {
                const stageInfo = getCurrentStage(lesson.day);
                const isUnlocked = isLessonUnlocked(lesson.day);
                const isCompleted = completedLessons.includes(lesson.day);
                const isCurrent = lesson.day === currentDay;

                // Add stage header when stage changes
                if (stageInfo.stage !== currentStage) {
                    currentStage = stageInfo.stage;
                    html += `
                        <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 107, 53, 0.15));
                                    padding: 1rem; border-radius: 10px; border-left: 4px solid var(--gold);
                                    margin: 1.5rem 0 1rem 0;">
                            <div style="font-size: 1.1rem; font-weight: 700; color: var(--gold); margin-bottom: 0.3rem;">
                                Stage ${stageInfo.stage}: ${stageInfo.name}${stageInfo.subtitle ? ' - ' + stageInfo.subtitle : ''}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--orange);">${stageInfo.leg}</div>
                            <div style="font-size: 0.8rem; color: var(--white); opacity: 0.8; font-style: italic; margin-top: 0.3rem;">
                                ${stageInfo.quote}
                            </div>
                        </div>
                    `;
                }

                // Add phase header when phase changes
                if (lesson.phaseTitle !== currentPhase) {
                    currentPhase = lesson.phaseTitle;
                    html += `
                        <div style="font-size: 0.95rem; font-weight: 600; color: var(--orange);
                                    margin: 1rem 0 0.5rem 0; padding-left: 0.5rem; border-left: 3px solid var(--orange);">
                            ${lesson.phaseTitle}
                        </div>
                    `;
                }

                // Lesson item
                const lockIcon = isCompleted ? '‚úÖ' : (isUnlocked ? 'üîì' : 'üîí');
                const opacity = isUnlocked ? '1' : '0.5';
                const cursor = isUnlocked ? 'pointer' : 'not-allowed';
                const hoverStyle = isUnlocked ? 'this.style.background="rgba(255,215,0,0.2)"' : '';
                const unhoverStyle = isUnlocked ? `this.style.background="${isCurrent ? 'rgba(255,215,0,0.15)' : 'rgba(255,255,255,0.05)'}"` : '';
                const currentBorder = isCurrent ? 'border: 2px solid var(--gold);' : 'border: 1px solid rgba(255,255,255,0.1);';
                const currentBg = isCurrent ? 'background: rgba(255,215,0,0.15);' : 'background: rgba(255,255,255,0.05);';

                html += `
                    <div onclick="${isUnlocked ? `goToLesson(${lesson.day})` : ''}"
                         onmouseover="${hoverStyle}"
                         onmouseout="${unhoverStyle}"
                         style="display: flex; align-items: center; gap: 1rem;
                                padding: 0.8rem; margin: 0.3rem 0;
                                ${currentBg} ${currentBorder}
                                border-radius: 8px; cursor: ${cursor}; opacity: ${opacity};
                                transition: all 0.3s;">
                        <div style="font-size: 1.2rem; min-width: 30px;">${lockIcon}</div>
                        <div style="flex: 1;">
                            <div style="font-size: 0.75rem; color: var(--orange); font-weight: 600;">
                                Day ${lesson.day} ‚Ä¢ Week ${lesson.week}
                            </div>
                            <div style="font-size: 0.9rem; color: var(--white); font-weight: 500;">
                                ${lesson.title}
                            </div>
                        </div>
                        ${isCurrent ? '<div style="font-size: 0.75rem; color: var(--gold); font-weight: 600;">‚óÑ YOU ARE HERE</div>' : ''}
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // Update current lesson display
        function updateCurrentLesson() {
            const lesson = getLessonByDay(currentDay);
            if (!lesson) {
                console.error('No lesson found for day:', currentDay);
                return;
            }

            // Update sidebar lesson card
            document.getElementById('lessonWeekPhase').textContent =
                `WEEK ${lesson.week} ‚Ä¢ DAY ${lesson.day}`;
            document.getElementById('lessonTitle').textContent = lesson.title;

            // Check if lesson is completed
            const isCompleted = completedLessons.includes(currentDay);
            const completeBtn = document.querySelector('#lessonCard button[onclick="completeLesson()"]');
            if (isCompleted) {
                completeBtn.innerHTML = '<i class="fas fa-check-circle"></i> Done';
                completeBtn.style.background = 'linear-gradient(135deg, var(--success), var(--purple))';
            } else {
                completeBtn.innerHTML = '<i class="fas fa-check"></i> Complete';
                completeBtn.style.background = '';
            }
        }

        // View lesson details
        function viewLesson() {
            alert('‚úÖ Button clicked! viewLesson function is running. Current day: ' + currentDay);
            console.log('üîç viewLesson called - currentDay:', currentDay);
            console.log('üîç curriculum exists:', !!curriculum);

            // Force load curriculum if not loaded
            if (!curriculum && typeof MANLAW_CURRICULUM !== 'undefined') {
                curriculum = MANLAW_CURRICULUM;
                console.log('‚úÖ Curriculum loaded on-demand');
            }

            const lesson = getLessonByDay(currentDay);
            console.log('üîç lesson found:', !!lesson, lesson);

            if (!lesson) {
                alert('‚ö†Ô∏è Lesson not found for day ' + currentDay + '. Curriculum may not be loaded properly. Please refresh.');
                console.error('‚ùå Lesson not found for day:', currentDay);
                console.error('‚ùå Curriculum status:', curriculum ? 'loaded' : 'not loaded');
                return;
            }

            console.log('‚úÖ Opening modal for lesson:', lesson.title);

            // Check tier access for FAM users
            if (!canAccessLesson(currentDay)) {
                showUpgradeNudge(`Lesson ${currentDay} and beyond`, 'Bronze');
                return;
            }

            // Populate modal
            document.getElementById('modalLessonWeek').textContent =
                `WEEK ${lesson.week} ‚Ä¢ DAY ${lesson.day}`;
            document.getElementById('modalLessonTitle').textContent = lesson.title;
            document.getElementById('modalLessonContent').textContent = lesson.content;
            document.getElementById('modalLessonActivity').textContent = lesson.activity;
            document.getElementById('modalLessonAssignment').textContent = lesson.assignment;

            // Update stage info in modal
            const stageInfo = getCurrentStage(currentDay);
            document.getElementById('modalStageNumber').textContent = `Stage ${stageInfo.stage}`;
            document.getElementById('modalStageName').textContent = stageInfo.name;
            document.getElementById('modalStageSubtitle').textContent = stageInfo.subtitle ? `- ${stageInfo.subtitle}` : '';
            document.getElementById('modalStageLeg').textContent = stageInfo.leg;

            // Generate and populate comprehension questions
            populateComprehensionQuestions(lesson);

            // Update stage overview content
            const overview = getStageOverview(stageInfo.stage);
            const overviewHTML = `
                <div style="margin-bottom: 1rem;">
                    <div style="font-size: 1rem; font-weight: 700; color: var(--gold); margin-bottom: 0.5rem;">
                        ${overview.legPhase}
                    </div>
                    <div style="font-size: 0.95rem; color: var(--white); margin-bottom: 0.5rem;">
                        <strong>Stage ${stageInfo.stage}: ${stageInfo.name}</strong> ‚Äì ${stageInfo.quote}
                    </div>
                    <div style="font-size: 0.9rem; color: var(--white); opacity: 0.9; margin-bottom: 0.3rem;">
                        ‚Üí ${overview.description}
                    </div>
                    <div style="font-size: 0.85rem; color: var(--orange); font-style: italic;">
                        ‚Üí Focus: <strong>${overview.focus}</strong>
                    </div>
                </div>
                <div style="background: rgba(0,0,0,0.2); padding: 1rem; border-radius: 8px;">
                    <div style="font-size: 0.85rem; font-weight: 600; color: var(--gold); margin-bottom: 0.5rem;">
                        üéØ What You'll Learn in This Stage:
                    </div>
                    <ul style="margin: 0; padding-left: 1.5rem; color: var(--white); opacity: 0.9; font-size: 0.85rem; line-height: 1.8;">
                        ${overview.keyLearnings.map(learning => `<li>${learning}</li>`).join('')}
                    </ul>
                </div>
            `;
            document.getElementById('stageOverviewContent').innerHTML = overviewHTML;

            // Show/hide app connection
            const appSection = document.getElementById('modalAppConnection');
            if (lesson.appConnection) {
                appSection.style.display = 'block';
                document.getElementById('modalAppName').textContent = lesson.appConnection.app;
                document.getElementById('modalAppHow').textContent = lesson.appConnection.how;
            } else {
                appSection.style.display = 'none';
            }

            // Show response sections
            document.getElementById("activityResponseSection").style.display = "block";
            document.getElementById("assignmentResponseSection").style.display = "block";
            
            // Clear previous responses and feedback
            document.getElementById("activityResponseInput").value = "";
            document.getElementById("assignmentResponseInput").value = "";
            document.getElementById("activityFeedback").style.display = "none";
            document.getElementById("assignmentFeedback").style.display = "none";

            // Open modal
            const modal = document.getElementById('lessonModal');
            console.log('üéØ Modal element found:', !!modal);
            if (modal) {
                modal.classList.add('show');
                console.log('‚úÖ Modal classList after adding show:', modal.classList.toString());
                console.log('‚úÖ Modal display style:', window.getComputedStyle(modal).display);
            } else {
                console.error('‚ùå lessonModal element not found in DOM!');
                alert('‚ö†Ô∏è Modal element not found. Page may be corrupted.');
            }
        }

        // Submit activity response to Coach ManLaw
        async function submitActivityResponse() {
            const lesson = getLessonByDay(currentDay);
            if (!lesson) {
                alert('Unable to determine current lesson');
                return;
            }

            const userResponse = document.getElementById('activityResponseInput').value.trim();
            if (!userResponse || userResponse.length < 10) {
                alert('Please write at least 10 characters in your response');
                return;
            }

            // Show loading state
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            button.disabled = true;

            try {
                const response = await fetch('/api/coach/activity-response', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: currentUserId || 'demo-user',
                        day: currentDay,
                        lessonTitle: lesson.title,
                        responseType: 'activity',
                        userResponse: userResponse,
                        btssImpact: lesson.btssImpact || 'all',
                        activity: lesson.activity
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Show feedback
                    document.getElementById('activityFeedbackText').textContent = data.feedback;
                    document.getElementById('activityFeedback').style.display = 'block';

                    // Clear input
                    document.getElementById('activityResponseInput').value = '';

                    // Scroll to feedback
                    document.getElementById('activityFeedback').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    alert('Error: ' + (data.message || 'Failed to submit response'));
                }
            } catch (error) {
                console.error('Submit error:', error);
                alert('Failed to submit your response. Please try again.');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // Submit assignment response to Coach ManLaw
        async function submitAssignmentResponse() {
            const lesson = getLessonByDay(currentDay);
            if (!lesson) {
                alert('Unable to determine current lesson');
                return;
            }

            const userResponse = document.getElementById('assignmentResponseInput').value.trim();
            if (!userResponse || userResponse.length < 10) {
                alert('Please write at least 10 characters in your response');
                return;
            }

            // Show loading state
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            button.disabled = true;

            try {
                const response = await fetch('/api/coach/activity-response', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userId: currentUserId || 'demo-user',
                        day: currentDay,
                        lessonTitle: lesson.title,
                        responseType: 'assignment',
                        userResponse: userResponse,
                        btssImpact: lesson.btssImpact || 'all',
                        activity: lesson.assignment
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Show feedback
                    document.getElementById('assignmentFeedbackText').textContent = data.feedback;
                    document.getElementById('assignmentFeedback').style.display = 'block';

                    // Clear input
                    document.getElementById('assignmentResponseInput').value = '';

                    // Scroll to feedback
                    document.getElementById('assignmentFeedback').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    alert('Error: ' + (data.message || 'Failed to submit response'));
                }
            } catch (error) {
                console.error('Submit error:', error);
                alert('Failed to submit your response. Please try again.');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // Close lesson modal
        function closeLessonModal() {
            document.getElementById('lessonModal').classList.remove('show');
        }

        // Complete lesson
        function completeLesson() {
            if (!completedLessons.includes(currentDay)) {
                completedLessons.push(currentDay);
                localStorage.setItem('coach_completed_lessons', JSON.stringify(completedLessons));

                // Update UI
                updateCurrentLesson();
                updateProgressDashboard();
                renderLessonOverview(); // Update lesson list to show completion

                // Close modal if open
                closeLessonModal();

                // Send congratulations message with social sharing option
                addCoachMessage(`
                    <strong>üéâ Lesson Complete!</strong><br><br>
                    You've completed Day ${currentDay}: "${getLessonByDay(currentDay).title}"<br><br>
                    Keep building, Legacy Builder! Ready for the next lesson?
                `);

                // Show social sharing for milestone days
                const milestoneDays = [1, 7, 13, 26, 39, 52, 65, 78, 90];
                if (milestoneDays.includes(currentDay)) {
                    setTimeout(() => showSocialShare(currentDay), 1000);
                }
            }
        }

        // ==================== INTRODUCTION AUDIO ====================

        // Play introduction audio with Luke
        function playIntroductionAudio() {
            const introText = `
                Hey Employee, Ready to Break Free?

                I'm Coach Manlaw‚Äîand I see you. You're trading time for money, building someone else's dream, feeling the weight of the paycheck trap.
                You know there's more, but the path from employee to entrepreneur feels unclear, risky, maybe even impossible.

                Let me be clear: This isn't just a career change. It's a complete identity shift.
                It's about unlearning dependency and rediscovering self-agency. Moving from surviving on a paycheck to creating value, systems, and legacy.

                THE 7-STAGE TRANSFORMATION JOURNEY: From Employee to Entrepreneur

                I'll guide you through 7 transformational stages, built on the 4 Legs of Your Billion-Dollar Table.
                Your success depends on your weakest leg‚Äîand we're strengthening ALL of them:

                Stage 1: Awakening ‚Äì Realize the trap. Recognize job security is an illusion. Hard work alone won't create freedom.

                Stage 2: Reprogramming ‚Äì Unlearn employee habits. Reprogram for growth, risk, leadership.

                Stage 3: Discovery ‚Äì Identify your purpose, passions, strengths. Find your profitable niche.

                Stage 4: Activation ‚Äì Test ideas. Learn by doing. Overcome fear through execution.

                Stage 5: Systemization ‚Äì Move from hustling to structuring. Build systems that work for you.

                Stage 6: Expansion ‚Äì Build teams, collaborations, communities that multiply your impact.

                Stage 7: Legacy ‚Äì Create systems that outlive you. Generational impact. Mentorship. Contribution.

                YOUR BILLIONAIRE TABLE FRAMEWORK:
                Mindset Mystery - Transform identity and beliefs
                Money Moves - Build wealth systems that work while you sleep
                Legacy Missions - Create scalable systems and automation
                Momentum Movement - Build influence and lead movements

                As a man thinks, so is he. But thinking without action is just dreaming.
                We're building systems, movements, and money machines.

                I am a Legacy Builder, You are a Legacy Builder, and Together we are Builders of Legacies.

                Your First Step: Take your BTSS assessment.
                I'll identify which stage you're in, which leg is weakest, and exactly where to focus your transformation.

                Let's transform you from employee to entrepreneur!
            `;

            if (currentUtterance && speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }

            currentUtterance = new SpeechSynthesisUtterance(introText);
            currentUtterance.rate = 0.9;
            currentUtterance.pitch = 1.0;
            currentUtterance.volume = 1.0;

            // Select Luke voice
            const voices = speechSynthesis.getVoices();
            const lukeVoice = voices.find(v => v.lang === 'en-ZA' && !v.name.toLowerCase().includes('female')) ||
                             voices.find(v => v.lang === 'en-ZA') ||
                             voices.find(v => v.name.includes('Luke') || v.name.includes('Thabo'));

            if (lukeVoice) {
                currentUtterance.voice = lukeVoice;
            }

            currentUtterance.onstart = () => {
                addCoachMessage('üéß Playing introduction... Luke is speaking to you!');
            };

            currentUtterance.onend = () => {
                addCoachMessage('‚úÖ Introduction complete. Ready to start your transformation?');
            };

            speechSynthesis.speak(currentUtterance);
        }

        // Read all 90 lessons
        function readAllLessons() {
            const allLessons = getAllLessons();
            if (allLessons.length === 0) {
                addCoachMessage('‚ö†Ô∏è Lessons not loaded yet. Please wait a moment and try again.');
                return;
            }

            let lessonText = `
                Your Complete 90-Day Transformation Journey.
                I'm going to read all 90 lesson titles organized by the 7 stages of transformation.
                Listen carefully to see the complete path from employee to entrepreneur.

            `;

            let currentStageNum = 0;
            allLessons.forEach((lesson) => {
                const stageInfo = getCurrentStage(lesson.day);

                // Announce new stage
                if (stageInfo.stage !== currentStageNum) {
                    currentStageNum = stageInfo.stage;
                    lessonText += `
                        Stage ${stageInfo.stage}: ${stageInfo.name}. ${stageInfo.leg}.
                    `;
                }

                lessonText += `
                    Day ${lesson.day}: ${lesson.title}.
                `;
            });

            lessonText += `
                That's your complete 90-day journey.
                All 90 lessons designed to transform you from employee to entrepreneur.
                Start with Day 1 and follow the path. Trust the process. Build your legacy.
            `;

            if (currentUtterance && speechSynthesis.speaking) {
                speechSynthesis.cancel();
            }

            currentUtterance = new SpeechSynthesisUtterance(lessonText);
            currentUtterance.rate = 1.0;
            currentUtterance.pitch = 1.0;
            currentUtterance.volume = 1.0;

            // Select Luke voice
            const voices = speechSynthesis.getVoices();
            const lukeVoice = voices.find(v => v.lang === 'en-ZA' && !v.name.toLowerCase().includes('female')) ||
                             voices.find(v => v.lang === 'en-ZA') ||
                             voices.find(v => v.name.includes('Luke') || v.name.includes('Thabo'));

            if (lukeVoice) {
                currentUtterance.voice = lukeVoice;
            }

            currentUtterance.onstart = () => {
                addCoachMessage('üéß Luke is now reading all 90 lessons... This will take a few minutes. Relax and listen to your transformation roadmap!');
            };

            currentUtterance.onend = () => {
                addCoachMessage('‚úÖ All 90 lessons read! That\'s your complete journey. Ready to start Day 1?');
            };

            speechSynthesis.speak(currentUtterance);
        }

        // ==================== COMPREHENSION SYSTEM ====================

        // Generate comprehension questions based on lesson content
        function populateComprehensionQuestions(lesson) {
            const container = document.getElementById('comprehensionQuestions');
            if (!container) return;

            // Generate 5 questions based on the lesson
            const questions = generateQuestionsFromLesson(lesson);

            let html = '';
            questions.forEach((q, index) => {
                html += `
                    <div style="margin-bottom: 1.5rem; padding: 1rem; background: rgba(0,0,0,0.2); border-radius: 10px;">
                        <div style="font-weight: 600; color: var(--gold); margin-bottom: 0.8rem;">
                            ${index + 1}. ${q.question}
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                            ${q.options.map((option, optIndex) => `
                                <label style="display: flex; align-items: center; padding: 0.8rem; background: rgba(255,255,255,0.05); border-radius: 8px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.background='rgba(255,215,0,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.05)'">
                                    <input type="radio" name="q${index}" value="${optIndex}" style="margin-right: 0.8rem; width: 18px; height: 18px; cursor: pointer;">
                                    <span style="color: var(--white); opacity: 0.9;">${option}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
            container.dataset.answers = JSON.stringify(questions.map(q => q.correctIndex));
        }

        // Generate questions from lesson content
        function generateQuestionsFromLesson(lesson) {
            const stageInfo = getCurrentStage(lesson.day);

            // Base questions - these are generic but contextual to the transformation
            const questions = [
                {
                    question: `What is the main focus of today's lesson: "${lesson.title}"?`,
                    options: [
                        "Understanding the challenge and identifying the problem",
                        "Taking immediate action without understanding",
                        "Avoiding the topic entirely",
                        "Waiting for someone else to solve it"
                    ],
                    correctIndex: 0
                },
                {
                    question: `Which stage of transformation are you in on Day ${lesson.day}?`,
                    options: [
                        `Stage ${stageInfo.stage}: ${stageInfo.name}`,
                        "I'm not in any particular stage",
                        "The final stage",
                        "Just starting"
                    ],
                    correctIndex: 0
                },
                {
                    question: "According to Coach Manlaw, what comes before action?",
                    options: [
                        "Perfect planning",
                        "Understanding and awareness",
                        "Getting permission",
                        "Waiting for the right time"
                    ],
                    correctIndex: 1
                },
                {
                    question: `This lesson primarily impacts which leg of the Billion-Dollar Table?`,
                    options: [
                        stageInfo.leg,
                        "None of the legs",
                        "All legs equally",
                        "Only financial aspects"
                    ],
                    correctIndex: 0
                },
                {
                    question: "What is the ultimate goal of the 90-day transformation programme?",
                    options: [
                        "To become rich quickly",
                        "To quit your job immediately",
                        "To transform from employee mindset to entrepreneur mindset and build legacy",
                        "To learn theory without implementation"
                    ],
                    correctIndex: 2
                }
            ];

            return questions;
        }

        // Check comprehension answers
        function checkComprehension() {
            const container = document.getElementById('comprehensionQuestions');
            const correctAnswers = JSON.parse(container.dataset.answers || '[]');

            let score = 0;
            let totalQuestions = correctAnswers.length;
            let results = [];

            correctAnswers.forEach((correctIndex, qIndex) => {
                const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                if (selected && parseInt(selected.value) === correctIndex) {
                    score++;
                    results.push(true);
                } else {
                    results.push(false);
                }
            });

            const percentage = Math.round((score / totalQuestions) * 100);
            const feedbackEl = document.getElementById('comprehensionFeedback');
            const feedbackText = document.getElementById('comprehensionFeedbackText');

            let message = '';
            let emoji = '';

            if (percentage === 100) {
                emoji = 'üèÜ';
                message = `<strong>Perfect Score! ${score}/${totalQuestions} (${percentage}%)</strong><br><br>Excellent! You've fully understood today's lesson. You're ready to move forward with the activity and assignment. This level of comprehension will accelerate your transformation!`;
            } else if (percentage >= 80) {
                emoji = '‚úÖ';
                message = `<strong>Great Job! ${score}/${totalQuestions} (${percentage}%)</strong><br><br>You've grasped the key concepts of today's lesson. Review the areas you missed to strengthen your understanding, then proceed with the activity and assignment.`;
            } else if (percentage >= 60) {
                emoji = 'üìñ';
                message = `<strong>Good Start! ${score}/${totalQuestions} (${percentage}%)</strong><br><br>You're on the right track, but I recommend re-reading today's lesson before moving to the activity. Understanding the foundation is crucial for lasting transformation.`;
            } else {
                emoji = 'üîÑ';
                message = `<strong>Needs Review: ${score}/${totalQuestions} (${percentage}%)</strong><br><br>Take your time to re-read today's lesson. Understanding comes before action. This isn't a race‚Äîit's a transformation. Read the lesson again, then retake the comprehension check.`;
            }

            feedbackText.innerHTML = `${emoji} ${message}`;
            feedbackEl.style.display = 'block';

            // Scroll to feedback
            feedbackEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ==================== JOURNAL SYSTEM ====================

        // Save entry to journal
        function saveToJournal(type) {
            const lesson = getLessonByDay(currentDay);
            if (!lesson) return;

            let content = '';
            let entryType = '';

            if (type === 'activity') {
                content = document.getElementById('activityResponseInput').value.trim();
                entryType = 'Activity';
            } else if (type === 'assignment') {
                content = document.getElementById('assignmentResponseInput').value.trim();
                entryType = 'Assignment';
            } else if (type === 'notes') {
                content = document.getElementById('personalNotesInput').value.trim();
                entryType = 'Personal Notes';
            } else if (type === 'comprehension') {
                // Save comprehension quiz results
                const container = document.getElementById('comprehensionQuestions');
                const correctAnswers = JSON.parse(container.dataset.answers || '[]');
                let results = [];
                correctAnswers.forEach((correctIndex, qIndex) => {
                    const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
                    const questionText = container.querySelectorAll('.assessment-item > div > div')[qIndex * 2]?.textContent || `Question ${qIndex + 1}`;
                    results.push({
                        question: questionText,
                        answered: selected ? parseInt(selected.value) === correctIndex : false
                    });
                });
                const score = results.filter(r => r.answered).length;
                content = `Comprehension Score: ${score}/${correctAnswers.length} (${Math.round((score/correctAnswers.length)*100)}%)\n\n`;
                results.forEach((r, i) => {
                    content += `${i + 1}. ${r.question.replace(/^\d+\.\s*/, '')} - ${r.answered ? '‚úì Correct' : '‚úó Incorrect'}\n`;
                });
                entryType = 'Comprehension';
            }

            if (!content) {
                addCoachMessage(`‚ö†Ô∏è Please write something in the ${entryType.toLowerCase()} field before saving!`);
                return;
            }

            // Get existing journal
            const journal = JSON.parse(localStorage.getItem('coach_journal') || '[]');

            // Create journal entry
            const entry = {
                id: Date.now(),
                day: currentDay,
                date: new Date().toISOString(),
                lessonTitle: lesson.title,
                type: entryType,
                content: content,
                stageInfo: getCurrentStage(currentDay)
            };

            // Add to journal
            journal.push(entry);
            localStorage.setItem('coach_journal', JSON.stringify(journal));

            // Show confirmation
            addCoachMessage(`
                <strong>‚úÖ Saved to Journal!</strong><br><br>
                Your ${entryType.toLowerCase()} for Day ${currentDay} has been saved to your transformation journal.
                You can view and download your complete journal anytime!
            `);

            // Clear the input field
            if (type === 'activity') document.getElementById('activityResponseInput').value = '';
            if (type === 'assignment') document.getElementById('assignmentResponseInput').value = '';
            if (type === 'notes') document.getElementById('personalNotesInput').value = '';
        }

        // Open journal modal
        function viewJournal() {
            const journal = JSON.parse(localStorage.getItem('coach_journal') || '[]');
            const container = document.getElementById('journalEntriesContainer');

            if (journal.length === 0) {
                container.innerHTML = `
                    <div class="assessment-item" style="text-align: center; padding: 3rem;">
                        <i class="fas fa-book-open" style="font-size: 3rem; color: var(--gold); opacity: 0.5; margin-bottom: 1rem;"></i>
                        <p style="color: var(--white); opacity: 0.7;">
                            Your journal is empty. Start writing your transformation story!
                        </p>
                    </div>
                `;
            } else {
                // Sort by day (most recent first)
                journal.sort((a, b) => b.day - a.day);

                let html = '';
                journal.forEach((entry) => {
                    const date = new Date(entry.date).toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    const typeColor = entry.type === 'Activity' ? 'var(--purple)' :
                                     entry.type === 'Assignment' ? 'var(--orange)' :
                                     'var(--success)';

                    html += `
                        <div class="assessment-item" style="border-left: 4px solid ${typeColor};">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <div>
                                    <div style="font-size: 0.85rem; color: ${typeColor}; font-weight: 600;">
                                        Day ${entry.day} ‚Ä¢ ${entry.type}
                                    </div>
                                    <div style="font-size: 0.95rem; color: var(--gold); font-weight: 600;">
                                        ${entry.lessonTitle}
                                    </div>
                                    <div style="font-size: 0.75rem; color: var(--white); opacity: 0.6;">
                                        ${date}
                                    </div>
                                </div>
                            </div>
                            <div style="color: var(--white); opacity: 0.9; line-height: 1.6; white-space: pre-wrap;">
                                ${entry.content}
                            </div>
                        </div>
                    `;
                });

                container.innerHTML = html;
            }

            document.getElementById('journalModal').classList.add('show');
        }

        // Close journal modal
        function closeJournal() {
            document.getElementById('journalModal').classList.remove('show');
        }

        // Download journal as text file
        function downloadJournal() {
            const journal = JSON.parse(localStorage.getItem('coach_journal') || '[]');

            if (journal.length === 0) {
                addCoachMessage('‚ö†Ô∏è Your journal is empty. Complete some activities and add notes first!');
                return;
            }

            // Sort by day
            journal.sort((a, b) => a.day - b.day);

            // Build text content
            let content = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                               ‚ïë
‚ïë        COACH MANLAW - 90-DAY TRANSFORMATION JOURNAL          ‚ïë
‚ïë        Employee to Entrepreneur Journey                      ‚ïë
‚ïë                                                               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

Generated: ${new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
Total Entries: ${journal.length}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

`;

            journal.forEach((entry, index) => {
                const date = new Date(entry.date).toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                content += `
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
ENTRY ${index + 1} | DAY ${entry.day} | ${entry.type.toUpperCase()}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Lesson: ${entry.lessonTitle}
Date: ${date}
Stage: Stage ${entry.stageInfo.stage} - ${entry.stageInfo.name}

${entry.content}

`;
            });

            content += `
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

"I am a Legacy Builder, You are a Legacy Builder,
and Together we are Builders of Legacies."

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
                www.z2blegacy.com
                Coach Manlaw - Legacy Builder Programme
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
`;

            // Create blob and download
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Coach_Manlaw_Journal_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            addCoachMessage('‚úÖ Journal downloaded successfully! Your transformation story is saved.');
        }

        // Clear journal (with confirmation)
        function clearJournal() {
            if (confirm('‚ö†Ô∏è Are you sure you want to clear your entire journal? This cannot be undone!\n\nTip: Download your journal first to keep a backup.')) {
                localStorage.removeItem('coach_journal');
                closeJournal();
                addCoachMessage('üóëÔ∏è Journal cleared. Your journal entries have been deleted.');
            }
        }

        // ==================== SOCIAL SHARING ====================

        // Show social sharing modal for milestones
        function showSocialShare(day) {
            const stageInfo = getCurrentStage(day);
            const lesson = getLessonByDay(day);

            let milestone = '';
            let shareText = '';

            if (day === 1) {
                milestone = 'üöÄ Started My Transformation!';
                shareText = `I just started my 90-day transformation from Employee to Entrepreneur with Coach Manlaw! Day 1 complete. üí™ #CoachManlaw #LegacyBuilder #Entrepreneur`;
            } else if (day === 13) {
                milestone = `üéâ Stage 1 Complete: Awakening!`;
                shareText = `Just completed Stage 1 of my transformation! I'm awakening to the employee trap and stepping into my entrepreneur identity. Day 13/90 ‚úÖ #CoachManlaw #Awakening #LegacyBuilder`;
            } else if (day === 26) {
                milestone = `üî• Stage 2 Complete: Reprogrammed!`;
                shareText = `Mind reprogrammed! Just finished Stage 2 of my 90-day transformation. Employee mindset ‚Üí Entrepreneur thinking. Day 26/90 ‚úÖ #CoachManlaw #MindsetShift #Entrepreneur`;
            } else if (day === 39) {
                milestone = `üíé Stage 3 Complete: Purpose Discovered!`;
                shareText = `Found my profitable purpose! Stage 3 complete. I know my zone of genius and ready to create value. Day 39/90 ‚úÖ #CoachManlaw #Purpose #LegacyBuilder`;
            } else if (day === 52) {
                milestone = `üí∞ Stage 4 Complete: First Income!`;
                shareText = `Generated my first entrepreneurial income! Stage 4 complete. From employee to earner. Day 52/90 ‚úÖ #CoachManlaw #FirstSale #Entrepreneur`;
            } else if (day === 65) {
                milestone = `‚öôÔ∏è Stage 5 Complete: Systems Built!`;
                shareText = `Business systems built! Stage 5 complete. Working ON the business, not just IN it. Day 65/90 ‚úÖ #CoachManlaw #Systems #BusinessOwner`;
            } else if (day === 78) {
                milestone = `üåç Stage 6 Complete: Team Activated!`;
                shareText = `Built my team and community! Stage 6 complete. Multiplying impact through others. Day 78/90 ‚úÖ #CoachManlaw #Leadership #LegacyBuilder`;
            } else if (day === 90) {
                milestone = `üëë TRANSFORMATION COMPLETE!`;
                shareText = `I DID IT! 90 days complete. From employee to entrepreneur. Legacy secured! üéâüî•üí™ Thank you Coach Manlaw! #CoachManlaw #90DayChallenge #Entrepreneur #LegacyBuilder`;
            } else {
                milestone = `Day ${day} Complete!`;
                shareText = `Day ${day}/90 complete in my transformation journey with Coach Manlaw! Building my legacy one day at a time. üí™ #CoachManlaw #LegacyBuilder`;
            }

            addCoachMessage(`
                <strong>${milestone}</strong><br><br>
                <div style="background: rgba(255,215,0,0.1); padding: 1rem; border-radius: 10px; border-left: 4px solid var(--gold); margin: 1rem 0;">
                    <strong>üì± Share Your Achievement!</strong><br><br>
                    <em style="font-size: 0.9rem;">"${shareText}"</em>
                </div>
                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button onclick="shareToFacebook('${encodeURIComponent(shareText)}')" style="flex: 1; min-width: 120px; padding: 0.8rem; background: linear-gradient(135deg, #1877F2, #0C5FAC); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                        <i class="fab fa-facebook"></i> Facebook
                    </button>
                    <button onclick="shareToTwitter('${encodeURIComponent(shareText)}')" style="flex: 1; min-width: 120px; padding: 0.8rem; background: linear-gradient(135deg, #1DA1F2, #0C85D0); border: none; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                        <i class="fab fa-twitter"></i> Twitter
                    </button>
                    <button onclick="copyShareText('${shareText.replace(/'/g, "\\'")}')" style="flex: 1; min-width: 120px; padding: 0.8rem; background: linear-gradient(135deg, var(--gold), var(--orange)); border: none; border-radius: 8px; color: var(--navy-blue); font-weight: 600; cursor: pointer;">
                        <i class="fas fa-copy"></i> Copy Text
                    </button>
                </div>
            `);
        }

        // Share to Facebook
        function shareToFacebook(text) {
            const url = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent('https://z2blegacy.com')}&quote=${text}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        // Share to Twitter
        function shareToTwitter(text) {
            const url = `https://twitter.com/intent/tweet?text=${text}&url=${encodeURIComponent('https://z2blegacy.com')}`;
            window.open(url, '_blank', 'width=600,height=400');
        }

        // Copy share text to clipboard
        function copyShareText(text) {
            navigator.clipboard.writeText(text).then(() => {
                addCoachMessage('‚úÖ Text copied to clipboard! Paste it anywhere you want to share your achievement.');
            }).catch(() => {
                addCoachMessage('‚ö†Ô∏è Could not copy text. Please copy it manually from the message above.');
            });
        }

        // Navigate to previous day
        function previousDay() {
            if (currentDay > 1) {
                currentDay--;
                localStorage.setItem('coach_current_day', currentDay);
                updateCurrentLesson();
                updateJourneyDay();
                renderLessonOverview(); // Update lesson overview
                closeLessonModal();
            }
        }

        // Navigate to next day
        function nextDay() {
            if (currentDay < 90) {
                // Check if FAM user trying to go beyond lesson 7
                if (!canAccessLesson(currentDay + 1)) {
                    showUpgradeNudge('Lessons 8-90', 'Bronze');
                    return;
                }

                currentDay++;
                localStorage.setItem('coach_current_day', currentDay);
                updateCurrentLesson();
                updateJourneyDay();
                renderLessonOverview(); // Update lesson overview
                closeLessonModal();
            }
        }

        // Show progress dashboard
        function showProgress() {
            updateProgressDashboard();
            document.getElementById('progressModal').classList.add('show');
        }

        // Close progress modal
        function closeProgress() {
            document.getElementById('progressModal').classList.remove('show');
        }

        // Show 90-Day Content List
        function show90DayList() {
            const container = document.getElementById('lessonOverviewContainer');
            if (container && container.parentElement) {
                // Scroll to the lesson overview section
                container.parentElement.scrollIntoView({ behavior: 'smooth', block: 'start' });

                // Add visual highlight effect
                container.parentElement.style.animation = 'pulse 1s ease-in-out';
                setTimeout(() => {
                    container.parentElement.style.animation = '';
                }, 1000);

                // Send confirmation message
                addCoachMessage(`
                    <strong>üìö 90-Day Content List</strong><br><br>
                    Here's your complete transformation roadmap! All 90 lessons are listed below, organized by the 7 transformation stages.<br><br>
                    üîí Locked lessons will unlock as you complete previous lessons.<br>
                    ‚úÖ Completed lessons show a checkmark.<br>
                    üîì Click any unlocked lesson to start learning!<br><br>
                    <em>Remember: Trust the process. Sequential learning ensures lasting transformation.</em>
                `);
            } else {
                // If container not found, try to render it
                renderLessonOverview();
                addCoachMessage('üìö Loading your 90-day content list... Please wait a moment.');
                setTimeout(() => {
                    show90DayList();
                }, 1000);
            }
        }

        // Update progress dashboard
        function updateProgressDashboard() {
            // Overall progress
            document.getElementById('progressDay').textContent = currentDay;
            document.getElementById('progressPercent').textContent = Math.round((currentDay / 90) * 100) + '%';
            document.getElementById('progressCompleted').textContent = completedLessons.length;

            // Phase progress
            const phase1Lessons = completedLessons.filter(d => d >= 1 && d <= 20);
            const phase2Lessons = completedLessons.filter(d => d >= 21 && d <= 35);
            const phase3Lessons = completedLessons.filter(d => d >= 36 && d <= 50);
            const phase4Lessons = completedLessons.filter(d => d >= 51 && d <= 65);

            const phase1Percent = Math.round((phase1Lessons.length / 20) * 100);
            const phase2Percent = Math.round((phase2Lessons.length / 15) * 100);
            const phase3Percent = Math.round((phase3Lessons.length / 15) * 100);
            const phase4Percent = Math.round((phase4Lessons.length / 15) * 100);

            document.getElementById('phase1Progress').textContent = phase1Percent + '%';
            document.getElementById('phase2Progress').textContent = phase2Percent + '%';
            document.getElementById('phase3Progress').textContent = phase3Percent + '%';
            document.getElementById('phase4Progress').textContent = phase4Percent + '%';

            document.getElementById('phase1Bar').style.width = phase1Percent + '%';
            document.getElementById('phase2Bar').style.width = phase2Percent + '%';
            document.getElementById('phase3Bar').style.width = phase3Percent + '%';
            document.getElementById('phase4Bar').style.width = phase4Percent + '%';

            // BTSS history
            const historyDiv = document.getElementById('btssHistory');
            if (btssHistory.length > 0) {
                let historyHTML = '<div style="display: grid; gap: 0.8rem;">';
                btssHistory.forEach((record, index) => {
                    const date = new Date(record.date).toLocaleDateString();
                    historyHTML += `
                        <div style="background: rgba(255,255,255,0.05); padding: 0.8rem; border-radius: 8px;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Assessment ${index + 1} - ${date}</div>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; font-size: 0.85rem;">
                                <div>üß† Mindset: ${record.mindset}%</div>
                                <div>üí∏ Money: ${record.money}%</div>
                                <div>‚öôÔ∏è Legacy: ${record.legacy}%</div>
                                <div>üåç Movement: ${record.movement}%</div>
                            </div>
                        </div>
                    `;
                });
                historyHTML += '</div>';
                historyDiv.innerHTML = historyHTML;
            }
        }

        // Get stage overview details
        function getStageOverview(stage) {
            const overviews = {
                1: {
                    legPhase: "üß† MINDSET MYSTERY - Awakening & Reprogramming Your Mind",
                    description: "Realize the trap. Recognize job security is an illusion. Hard work alone won't create freedom.",
                    focus: "Awareness ‚Üí Financial self-realization",
                    keyLearnings: [
                        "Identify the employee trap and psychological chains of employment",
                        "Recognize that job security is an illusion",
                        "Understand that hard work alone won't create freedom",
                        "Begin shifting from employee to entrepreneur mindset"
                    ]
                },
                2: {
                    legPhase: "üß† MINDSET MYSTERY - Awakening & Reprogramming Your Mind",
                    description: "Unlearn employee habits (fear, dependency, trading time for money). Reprogram for growth, risk, leadership.",
                    focus: "Unlearning ‚Üí Building a Money Mindset",
                    keyLearnings: [
                        "Identify and challenge limiting employee beliefs",
                        "Develop calculated risk-taking skills",
                        "Build self-agency and independence",
                        "Adopt abundance thinking over scarcity mindset"
                    ]
                },
                3: {
                    legPhase: "üí∏ MONEY MOVES - From Value Discovery to First Income",
                    description: "Identify your purpose, passions, strengths. Find your profitable niche‚Äîyour true path as a value creator.",
                    focus: "Self-awareness ‚Üí Profitable purpose",
                    keyLearnings: [
                        "Discover your zone of genius and transferable skills",
                        "Identify market needs you can solve",
                        "Define your unique value proposition",
                        "Select and validate your profitable niche"
                    ]
                },
                4: {
                    legPhase: "üí∏ MONEY MOVES - From Value Discovery to First Income",
                    description: "Test ideas through small offers or side hustles. Learn by doing. Overcome fear through execution.",
                    focus: "Action ‚Üí First income stream",
                    keyLearnings: [
                        "Launch your Minimum Viable Offer (MVO)",
                        "Acquire your first customer",
                        "Generate your first entrepreneurial income",
                        "Learn from market feedback and iterate"
                    ]
                },
                5: {
                    legPhase: "‚öôÔ∏è LEGACY MISSIONS - Building Systems That Work For You",
                    description: "Move from hustling to structuring. Build systems, automations, processes that create leverage and consistency.",
                    focus: "Self-employment ‚Üí Business ownership",
                    keyLearnings: [
                        "Document your core business processes",
                        "Implement marketing, sales, and delivery systems",
                        "Create SOPs (Standard Operating Procedures)",
                        "Build automation that works without constant personal effort"
                    ]
                },
                6: {
                    legPhase: "üåç MOMENTUM MOVEMENT - From Solo Success to Generational Impact",
                    description: "Shift from working IN the business to working ON it. Build teams, collaborations, communities that multiply your impact.",
                    focus: "Leadership ‚Üí Community growth",
                    keyLearnings: [
                        "Build and lead your first team members",
                        "Develop delegation and leadership skills",
                        "Create strategic partnerships and collaborations",
                        "Build community and expand market reach"
                    ]
                },
                7: {
                    legPhase: "üåç MOMENTUM MOVEMENT - From Solo Success to Generational Impact",
                    description: "Transcend personal success. Focus on generational impact, mentorship, contribution.",
                    focus: "Purpose-driven leadership ‚Üí Legacy creation",
                    keyLearnings: [
                        "Create systems that outlive you",
                        "Develop succession and legacy plans",
                        "Become a mentor and industry guide",
                        "Build generational wealth and lasting impact"
                    ]
                }
            };
            return overviews[stage] || overviews[1];
        }

        // Get current stage info based on day
        function getCurrentStage(day) {
            const stages = [
                {
                    stage: 1,
                    name: "Awakening",
                    subtitle: "The Problem",
                    dayRange: [1, 13],
                    leg: "üß† Mindset Mystery",
                    quote: '"I\'m not building my dream. I\'m helping someone else build theirs."',
                    focus: "Realize the employee trap"
                },
                {
                    stage: 2,
                    name: "Reprogramming",
                    dayRange: [14, 26],
                    leg: "üß† Mindset Mystery",
                    quote: '"If I don\'t change my thinking, I\'ll repeat the same cycle."',
                    focus: "Reset mindset for entrepreneurship"
                },
                {
                    stage: 3,
                    name: "Discovery",
                    dayRange: [27, 39],
                    leg: "üí∏ Money Moves",
                    quote: '"What do I have that can solve problems or create value?"',
                    focus: "Find your profitable purpose"
                },
                {
                    stage: 4,
                    name: "Activation",
                    dayRange: [40, 52],
                    leg: "üí∏ Money Moves",
                    quote: '"Done is better than perfect. Action creates clarity."',
                    focus: "Generate first entrepreneurial income"
                },
                {
                    stage: 5,
                    name: "Systemization",
                    dayRange: [53, 65],
                    leg: "‚öôÔ∏è Legacy Missions",
                    quote: '"I don\'t want to work harder‚ÄîI want to build a system that works for me."',
                    focus: "Build systems that work without you"
                },
                {
                    stage: 6,
                    name: "Expansion",
                    dayRange: [66, 78],
                    leg: "üåç Momentum Movement",
                    quote: '"I grow by helping others grow."',
                    focus: "Scale through teams and community"
                },
                {
                    stage: 7,
                    name: "Legacy",
                    dayRange: [79, 90],
                    leg: "üåç Momentum Movement",
                    quote: '"My purpose is to create systems that outlive me."',
                    focus: "Create generational impact"
                }
            ];

            for (const stageInfo of stages) {
                if (day >= stageInfo.dayRange[0] && day <= stageInfo.dayRange[1]) {
                    return stageInfo;
                }
            }

            // Default to stage 1 if out of range
            return stages[0];
        }

        // Update current stage display
        function updateCurrentStage() {
            const stageInfo = getCurrentStage(currentDay);

            document.getElementById('stageNumber').textContent = `Stage ${stageInfo.stage}`;
            document.getElementById('stageName').textContent = stageInfo.name;

            // Update subtitle if exists
            const subtitleEl = document.getElementById('stageSubtitle');
            if (subtitleEl) {
                subtitleEl.textContent = stageInfo.subtitle ? `- ${stageInfo.subtitle}` : '';
            }

            document.getElementById('stageLeg').textContent = stageInfo.leg;
            document.getElementById('stageQuote').textContent = stageInfo.quote;

            // Update header with stage info
            const lesson = getLessonByDay(currentDay);
            if (lesson) {
                document.getElementById('headerStatus').textContent =
                    `Day ${currentDay} ‚Ä¢ Stage ${stageInfo.stage}: ${stageInfo.name} ‚Ä¢ ${stageInfo.leg}`;
            } else {
                document.getElementById('headerStatus').textContent =
                    `Day ${currentDay} ‚Ä¢ Stage ${stageInfo.stage}: ${stageInfo.name}`;
            }

            // Show milestone celebration if completing a stage
            const isStageComplete = currentDay === stageInfo.dayRange[1];
            if (isStageComplete && !localStorage.getItem(`stage${stageInfo.stage}_celebrated`)) {
                setTimeout(() => {
                    const milestones = [
                        "üéâ Stage 1 Complete! You've Awakened!",
                        "üéâ Stage 2 Complete! Mind Reprogrammed!",
                        "üéâ Stage 3 Complete! Purpose Discovered!",
                        "üéâ Stage 4 Complete! First Income Generated!",
                        "üéâ Stage 5 Complete! Systems Built!",
                        "üéâ Stage 6 Complete! Team & Community Established!",
                        "üéâ Stage 7 Complete! Legacy Secured! YOU ARE AN ENTREPRENEUR!"
                    ];
                    addCoachMessage(`
                        <strong>${milestones[stageInfo.stage - 1]}</strong><br><br>
                        Congratulations! You've completed <strong>Stage ${stageInfo.stage}: ${stageInfo.name}</strong>.<br><br>
                        ${stageInfo.stage < 7 ? `üöÄ Ready for <strong>Stage ${stageInfo.stage + 1}</strong>? Let's keep building!` : 'üëë You did it! From employee to entrepreneur in 90 days. Welcome to your new life!'}
                    `);
                    localStorage.setItem(`stage${stageInfo.stage}_celebrated`, 'true');
                }, 2000);
            }
        }

        // Update journey day
        function updateJourneyDay() {
            document.getElementById('statsDay').textContent = `Day ${currentDay}`;
            updateCurrentStage(); // Update stage info
        }

        // Setup slider listeners
        function setupSliderListeners() {
            console.log('Setting up slider listeners...');

            const sliders = ['mindset', 'money', 'legacy', 'movement'];
            sliders.forEach(name => {
                const slider = document.getElementById(name + 'Slider');
                const value = document.getElementById(name + 'Value');
                if (slider && value) {
                    slider.oninput = () => {
                        value.textContent = slider.value;
                    };
                    console.log(`Slider ${name} initialized`);
                } else {
                    console.error(`Slider ${name} not found`);
                }
            });

            // Set up submit button with multiple methods
            console.log('Setting up submit button...');
            const submitBtn = document.getElementById('submitAssessmentBtn');
            if (submitBtn) {
                // Remove any existing listeners
                const newBtn = submitBtn.cloneNode(true);
                submitBtn.parentNode.replaceChild(newBtn, submitBtn);

                // Add click listener
                newBtn.addEventListener('click', function(e) {
                    console.log('=== SUBMIT BUTTON CLICKED ===');
                    e.stopPropagation();
                    handleAssessmentSubmit();
                }, true);

                // Add mousedown listener as backup
                newBtn.addEventListener('mousedown', function(e) {
                    console.log('Submit button mousedown');
                }, true);

                console.log('Submit button listeners attached');
            } else {
                console.error('Submit button not found!');
            }
        }

        // Separate handler function
        function handleAssessmentSubmit() {
            console.log('handleAssessmentSubmit called');

            // Get values
            const mindsetVal = document.getElementById('mindsetSlider')?.value || 50;
            const moneyVal = document.getElementById('moneySlider')?.value || 50;
            const legacyVal = document.getElementById('legacySlider')?.value || 50;
            const movementVal = document.getElementById('movementSlider')?.value || 50;

            console.log('Values:', {mindsetVal, moneyVal, legacyVal, movementVal});

            // Create scores object
            const scores = {
                mindset: parseInt(mindsetVal),
                money: parseInt(moneyVal),
                legacy: parseInt(legacyVal),
                movement: parseInt(movementVal),
                date: new Date().toISOString(),
                day: currentDay
            };

            // Update global variable
            btssScores = scores;

            // Save
            localStorage.setItem('coach_btss_scores', JSON.stringify(scores));

            // Add to history
            btssHistory.push(scores);
            localStorage.setItem('coach_btss_history', JSON.stringify(btssHistory));

            console.log('Assessment saved:', scores);

            // Update UI
            loadBTSSScores();

            // Close modal
            closeAssessment();

            // Calculate overall
            const overall = Math.round((scores.mindset + scores.money + scores.legacy + scores.movement) / 4);

            // Get weakest leg
            const legs = [
                { name: 'Mindset Mystery', score: scores.mindset },
                { name: 'Money Moves', score: scores.money },
                { name: 'Legacy Missions', score: scores.legacy },
                { name: 'Momentum Movement', score: scores.movement }
            ];
            const weakestLeg = legs.reduce((min, leg) => leg.score < min.score ? leg : min, legs[0]);

            // Send message
            const message = `
                <strong>BTSS Assessment Complete! üéØ</strong><br><br>
                <strong>Your Scores:</strong><br>
                üß† Mindset Mystery: ${scores.mindset}/100<br>
                üí∏ Money Moves: ${scores.money}/100<br>
                ‚öôÔ∏è Legacy Missions: ${scores.legacy}/100<br>
                üåç Momentum Movement: ${scores.movement}/100<br><br>
                <strong>Overall BTSS: ${overall}%</strong><br>
                Your weakest leg is <strong>${weakestLeg.name}</strong>. Remember: a table is only as strong as its weakest leg! Let's focus on strengthening this area to build your billion-dollar empire. üí™
            `;

            addCoachMessage(message);

            console.log('Assessment complete!');
        }

        // Load BTSS scores
        function loadBTSSScores() {
            if (!btssScores) return;

            document.getElementById('mindsetScore').textContent = btssScores.mindset;
            document.getElementById('moneyScore').textContent = btssScores.money;
            document.getElementById('legacyScore').textContent = btssScores.legacy;
            document.getElementById('movementScore').textContent = btssScores.movement;

            document.getElementById('mindsetBar').style.width = btssScores.mindset + '%';
            document.getElementById('moneyBar').style.width = btssScores.money + '%';
            document.getElementById('legacyBar').style.width = btssScores.legacy + '%';
            document.getElementById('movementBar').style.width = btssScores.movement + '%';

            const overall = Math.round((btssScores.mindset + btssScores.money + btssScores.legacy + btssScores.movement) / 4);
            document.getElementById('statsOverall').textContent = overall + '%';
        }

        // Open assessment
        function openAssessment() {
            document.getElementById('assessmentModal').classList.add('show');
        }

        // Close assessment
        function closeAssessment() {
            document.getElementById('assessmentModal').classList.remove('show');
        }

        // Submit assessment
        function submitAssessment() {
            try {
                console.log('submitAssessment called');

                // Get slider elements
                const mindsetSlider = document.getElementById('mindsetSlider');
                const moneySlider = document.getElementById('moneySlider');
                const legacySlider = document.getElementById('legacySlider');
                const movementSlider = document.getElementById('movementSlider');

                // Check if elements exist
                if (!mindsetSlider || !moneySlider || !legacySlider || !movementSlider) {
                    console.error('One or more sliders not found!');
                    alert('Error: Assessment sliders not found. Please refresh the page and try again.');
                    return;
                }

                // Get values
                btssScores = {
                    mindset: parseInt(mindsetSlider.value),
                    money: parseInt(moneySlider.value),
                    legacy: parseInt(legacySlider.value),
                    movement: parseInt(movementSlider.value),
                    date: new Date().toISOString(),
                    day: currentDay
                };

                console.log('BTSS Scores:', btssScores);

                // Validate scores
                if (isNaN(btssScores.mindset) || isNaN(btssScores.money) || isNaN(btssScores.legacy) || isNaN(btssScores.movement)) {
                    console.error('Invalid scores detected');
                    alert('Error: Invalid assessment values. Please try again.');
                    return;
                }

                // Save current scores
                localStorage.setItem('coach_btss_scores', JSON.stringify(btssScores));

                // Add to history
                btssHistory.push(btssScores);
                localStorage.setItem('coach_btss_history', JSON.stringify(btssHistory));

                console.log('Assessment saved successfully');

                // Update UI
                loadBTSSScores();
                closeAssessment();

                // Send confirmation message
                const overall = Math.round((btssScores.mindset + btssScores.money + btssScores.legacy + btssScores.movement) / 4);
                const weakest = getWeakestLeg();

                // Check for improvement if previous assessment exists
                let improvementMsg = '';
                if (btssHistory.length > 1) {
                    const previous = btssHistory[btssHistory.length - 2];
                    const prevOverall = Math.round((previous.mindset + previous.money + previous.legacy + previous.movement) / 4);
                    const improvement = overall - prevOverall;
                    if (improvement > 0) {
                        improvementMsg = `<br><strong>üìà You've improved ${improvement} points since your last assessment!</strong><br>`;
                    }
                }

                addCoachMessage(`
                    <strong>BTSS Assessment Complete! üéØ</strong><br><br>
                    <strong>Your Scores:</strong><br>
                    üß† Mindset Mystery: ${btssScores.mindset}/100<br>
                    üí∏ Money Moves: ${btssScores.money}/100<br>
                    ‚öôÔ∏è Legacy Missions: ${btssScores.legacy}/100<br>
                    üåç Momentum Movement: ${btssScores.movement}/100<br><br>
                    <strong>Overall BTSS: ${overall}%</strong>${improvementMsg}<br>
                    Your weakest leg is <strong>${weakest.name}</strong>. Remember: a table is only as strong as its weakest leg! Let's focus on strengthening this area to build your billion-dollar empire. üí™
                `);

                console.log('Assessment message added to chat');

            } catch (error) {
                console.error('Error in submitAssessment:', error);
                alert('An error occurred while submitting the assessment: ' + error.message + '\n\nPlease try again or refresh the page.');
            }
        }

        // Get weakest leg
        function getWeakestLeg() {
            if (!btssScores) return null;
            const legs = [
                { name: 'Mindset Mystery', score: btssScores.mindset, icon: 'üß†' },
                { name: 'Money Moves', score: btssScores.money, icon: 'üí∏' },
                { name: 'Legacy Missions', score: btssScores.legacy, icon: '‚öôÔ∏è' },
                { name: 'Momentum Movement', score: btssScores.movement, icon: 'üåç' }
            ];
            return legs.reduce((min, leg) => leg.score < min.score ? leg : min);
        }

        // Show settings
        function showSettings() {
            document.getElementById('settingsModal').classList.add('show');
        }

        // Close settings
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('show');
        }

        // Open Activity Center
        function openActivity() {
            document.getElementById('activityModal').classList.add('show');
        }

        // Close Activity Center
        function closeActivity() {
            document.getElementById('activityModal').classList.remove('show');
        }

        // Submit Activity Response
        function submitActivityResponse() {
            const response = document.getElementById('activityResponseInput').value.trim();

            if (!response) {
                alert('Please enter your response before submitting.');
                return;
            }

            // Here you would normally send to Coach Manlaw AI for feedback
            console.log('Activity Response:', response);

            // Show success message
            alert('‚úÖ Response submitted successfully!\n\nCoach Manlaw will review your activity and provide personalized feedback.');

            // Clear the input
            document.getElementById('activityResponseInput').value = '';

            // Close modal
            closeActivity();

            // You could also send this to the chat as a message to Coach Manlaw
            sendMessage('Activity Response: ' + response);
        }

        // Save settings
        function saveSettings() {
            const apiKey = document.getElementById('claudeKey').value.trim();
            const model = document.getElementById('aiModel').value;

            if (apiKey) {
                localStorage.setItem('coach_api_key', apiKey);
            }
            localStorage.setItem('coach_ai_model', model);

            alert('‚úÖ Settings saved!');
            closeSettings();
        }

        // Load settings
        function loadSettings() {
            const apiKey = localStorage.getItem('coach_api_key');
            const model = localStorage.getItem('coach_ai_model') || 'claude-sonnet-4-20250514';

            if (apiKey) {
                document.getElementById('claudeKey').value = apiKey;
            }
            document.getElementById('aiModel').value = model;
        }

        // Get current time
        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        // Add message
        function addMessage(text, isUser = false) {
            const message = document.createElement('div');
            message.className = `message ${isUser ? 'user' : 'coach'}`;

            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = isUser ? 'üë§' : 'üéØ';

            const content = document.createElement('div');
            content.className = 'message-content';
            content.innerHTML = `
                <div class="message-text">${text}</div>
                <div class="message-time">${getCurrentTime()}</div>
            `;

            if (isUser) {
                message.appendChild(content);
                message.appendChild(avatar);
            } else {
                message.appendChild(avatar);
                message.appendChild(content);
            }

            const chatMessages = document.getElementById('chatMessages');
            const typingIndicator = document.getElementById('typingIndicator');
            chatMessages.insertBefore(message, typingIndicator);
            scrollToBottom();

            // Save to history
            chatHistory.push({
                text,
                isUser,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('coach_chat_history', JSON.stringify(chatHistory));
        }

        // Add coach message (shorthand)
        function addCoachMessage(text) {
            addMessage(text, false);
        }

        // Scroll to bottom
        function scrollToBottom() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Show typing indicator
        function showTyping() {
            document.getElementById('typingIndicator').classList.add('active');
            scrollToBottom();
        }

        // Hide typing indicator
        function hideTyping() {
            document.getElementById('typingIndicator').classList.remove('active');
        }

        // Send message
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            if (!text) return;

            // SECURITY: API key is now handled server-side, no client-side check needed

            // Add user message
            addMessage(text, true);
            input.value = '';

            // Show typing
            showTyping();
            document.getElementById('sendBtn').disabled = true;

            try {
                // Build context
                const systemPrompt = buildSystemPrompt();
                // SECURITY: API key parameter no longer needed - handled by backend
                const response = await callClaudeAPI(systemPrompt, text, null);

                hideTyping();
                addCoachMessage(response);

            } catch (error) {
                hideTyping();
                addCoachMessage(`Sorry, I encountered an error: ${error.message}. Please check your API key and try again.`);
            }

            document.getElementById('sendBtn').disabled = false;
            input.focus();
        }

        // Build system prompt
        function buildSystemPrompt() {
            const weakest = btssScores ? getWeakestLeg() : null;
            const overall = btssScores ? Math.round((btssScores.mindset + btssScores.money + btssScores.legacy + btssScores.movement) / 4) : null;
            const currentLesson = getLessonByDay(currentDay);
            const lessonsCompleted = completedLessons.length;
            const completionRate = Math.round((lessonsCompleted / 75) * 100);

            // Get app recommendation for current lesson
            let appRecommendation = '';
            if (currentLesson && currentLesson.appConnection) {
                appRecommendation = `\n- Recommended App for Today: ${currentLesson.appConnection.app} - ${currentLesson.appConnection.how}`;
            }

            return `You are Coach Manlaw, a powerhouse AI billionaire coach for the Zero2Billionaires (Z2B) platform.

CURRENT CURRICULUM CONTEXT:
${currentLesson ? `
- Current Day: ${currentDay} of 90
- Current Lesson: "${currentLesson.title}"
- Week ${currentLesson.week}: ${currentLesson.theme}
- Phase: ${currentLesson.phaseTitle}
- Focus Area: ${currentLesson.btssImpact.toUpperCase()}
- Today's Content: ${currentLesson.content.substring(0, 150)}...
- Today's Activity: ${currentLesson.activity}
- Today's Assignment: ${currentLesson.assignment}${appRecommendation}
- Lessons Completed: ${lessonsCompleted}/75 (${completionRate}% of program)
` : '- No curriculum loaded yet'}

IMPORTANT: You are teaching a structured 90-day transformation program. Always be aware of:
1. What day the member is on in their journey
2. What lesson they're currently working on
3. Whether they've completed today's activity and assignment
4. Which phase and leg of the table they're focusing on
5. How their progress aligns with the curriculum

When coaching:
- Reference their current lesson naturally in conversation
- Encourage them to complete today's activity/assignment if they haven't
- Connect their questions to the current curriculum focus
- Remind them of app recommendations when relevant
- Celebrate milestones (Day 20, 35, 50, 65, 75)
- If they seem stuck, suggest reviewing or completing the current day's lesson before moving ahead

YOUR PERSONALITY FRAMEWORK (Coach Manlaw DNA):
- 15% Biblical Principles - Grounded wisdom from Proverbs, Matthew, Philippians. Faith as foundation, not just motivation.
- 10% Humor & Wit - Lighthearted observations that cut through overwhelm. Make success feel attainable and fun.
- 25% Deep Psychology - Understanding human behavior, habits, beliefs, and mental models. Master of mindset transformation.
- 25% Visionary Leadership - Painting billion-dollar futures. Helping Legacy Builders see 10x beyond their current vision.
- 25% Strategic Business Execution - No fluff. Actionable steps, systems, frameworks, and tactical moves that generate results.

YOUR MISSION:
Transform employees into Legacy Builders who build Billionaire Mindsets, Money Systems, Movements, and Legacies using the Four Legs of a Billionaire Table framework.

THE FOUR LEGS:
1. üß† Mindset Mystery - Identity transformation, belief systems, vision clarity, spiritual alignment, mental wealth
2. üí∏ Money Moves - Financial intelligence, multiple income streams, wealth multiplication, marketing mastery, sales systems
3. ‚öôÔ∏è Legacy Missions - Scalable systems, automation, purpose-driven business, delegation, time leverage, management excellence
4. üåç Momentum Movement - Impact creation, influence amplification, community building, leadership development, movement creation

USER CONTEXT:
${btssScores ? `
- Current BTSS Scores:
  ‚Ä¢ Mindset Mystery: ${btssScores.mindset}/100
  ‚Ä¢ Money Moves: ${btssScores.money}/100
  ‚Ä¢ Legacy Missions: ${btssScores.legacy}/100
  ‚Ä¢ Momentum Movement: ${btssScores.movement}/100
- Overall BTSS: ${overall}%
- Weakest Leg: ${weakest.name} (${weakest.score}/100) ‚Üê PRIORITY FOCUS
` : '- No BTSS assessment yet (encourage them to take it!)'}

COACHING STYLE:
- Speak with warmth, authority, and wit (2-3 concise paragraphs)
- Use emojis strategically for emphasis
- Blend Biblical wisdom seamlessly with business strategy
- Challenge limiting beliefs with compassion + humor
- Provide specific, actionable tactical steps (not just inspiration)
- Celebrate small wins like they're billion-dollar victories
- Focus 60% of coaching on strengthening the weakest leg
- Drop Scripture naturally when it fits (Proverbs for wisdom, Matthew for mission, Philippians for mindset)
- Be conversational, not corporate. Be mentor, not machine.

COMMUNICATION PATTERNS:
- Start responses with affirmation or light humor
- Use analogies and stories to illustrate complex concepts
- Ask provocative questions that trigger breakthrough thinking
- Give 1-3 specific action steps in every response
- End with empowering statement or challenge

CORE PHILOSOPHY:
"I am a Legacy Builder, You are a Legacy Builder, and Together we are Builders of Legacies."

KEY PRINCIPLES:
- You must be rich in thought before you're rich in bank balance
- Don't chase money‚Äîbuild systems that multiply it while you sleep
- Your weakest leg determines your table's stability‚Äîfix it first
- Every employee has a billionaire inside‚Äîwake them up
- When mission becomes movement, influence becomes infinite
- Legacy isn't what you build‚Äîit's what outlives you

TACTICAL FRAMEWORKS TO REFERENCE:
- BTSS Assessment (measure before you manage)
- Four Income Streams Model (earned, profit, passive, portfolio)
- 80/20 Delegation Framework (automate/delegate 80%, focus on 20%)
- Network Effect Multiplication (1 person ‚Üí 10 ‚Üí 100 ‚Üí 1000)
- Faith-Driven Decision Matrix (alignment + strategy = unstoppable)

Respond as Coach Manlaw would - sharp, strategic, faith-filled, funny when appropriate, and always actionable!`;
        }

        // Call AI API via backend proxy (prevents CORS issues)
        async function callClaudeAPI(systemPrompt, userMessage, apiKey) {
            try {
                // SECURITY: Use backend proxy - API key is handled server-side
                const proxyUrl = window.location.origin + '/api/claude-proxy.php';

                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        // SECURITY: API key NOT sent from frontend - handled by backend
                        systemPrompt: systemPrompt,
                        userMessage: userMessage
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'API request failed');
                }

                const data = await response.json();

                if (data.content && data.content[0] && data.content[0].text) {
                    return data.content[0].text.trim();
                } else {
                    throw new Error('Invalid response from AI service');
                }

            } catch (error) {
                console.error('AI service error:', error);
                throw error;
            }
        }

        // Send quick message
        function sendQuickMessage(text) {
            document.getElementById('messageInput').value = text;
            sendMessage();
        }

        // Handle key press
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // ===== AUDIO & VIDEO LEARNING MODES =====

        // Set learning mode
        function setLearningMode(mode) {
            // Check tier access
            if (mode === 'listen' && !canAccessAudio()) {
                showUpgradeNudge('Audio Learning Mode', 'Copper');
                return;
            }

            if (mode === 'watch' && !canAccessVideo()) {
                showUpgradeNudge('Video Learning Mode', 'Silver');
                return;
            }

            learningMode = mode;
            localStorage.setItem('coach_learning_mode', mode);

            // Update button styles
            ['read', 'listen', 'watch'].forEach(m => {
                const btn = document.getElementById('mode' + m.charAt(0).toUpperCase() + m.slice(1));
                if (m === mode) {
                    btn.style.background = 'linear-gradient(135deg, var(--gold), var(--orange))';
                    btn.style.color = 'var(--navy-blue)';
                } else {
                    btn.style.background = '';
                    btn.style.color = '';
                }
            });

            // Show/hide relevant sections
            const contentSections = ['modalLessonContent', 'modalLessonActivity', 'modalLessonAssignment'];
            const audioPlayer = document.getElementById('audioPlayer');
            const videoPlayer = document.getElementById('videoPlayer');

            if (mode === 'read') {
                contentSections.forEach(id => document.getElementById(id).closest('.assessment-item').style.display = 'block');
                audioPlayer.style.display = 'none';
                videoPlayer.style.display = 'none';
                stopAudio();
                stopAnimation();
            } else if (mode === 'listen') {
                // Show BOTH content and audio player so user can read while listening
                contentSections.forEach(id => document.getElementById(id).closest('.assessment-item').style.display = 'block');
                audioPlayer.style.display = 'block';
                videoPlayer.style.display = 'none';
                stopAnimation();
                prepareAudio();
            } else if (mode === 'watch') {
                contentSections.forEach(id => document.getElementById(id).closest('.assessment-item').style.display = 'none');
                audioPlayer.style.display = 'none';
                videoPlayer.style.display = 'block';
                stopAudio();
                startAnimation();
            }
        }

        // Prepare audio for lesson
        function prepareAudio() {
            const lesson = getLessonByDay(currentDay);
            if (!lesson) return;

            console.log('üéµ Preparing audio for lesson:', lesson.title);

            // Get current stage info for context
            const stageInfo = getCurrentStage(currentDay);
            const overview = getStageOverview(stageInfo.stage);

            // Build stage overview narration
            const stageOverviewText = `
                ${overview.legPhase}.
                Stage ${stageInfo.stage}: ${stageInfo.name}. ${stageInfo.quote}
                ${overview.description}
                Focus: ${overview.focus}
            `;

            // Combine lesson text with stage context and overview (EXCLUDING activity and assignment)
            const fullText = `
                Welcome to Day ${currentDay} of your 90-day transformation journey.

                Let me remind you where you are in your transformation:
                ${stageOverviewText}

                Today's lesson: ${lesson.title}.

                ${lesson.content}

                This is the end of today's lesson. Now, test your understanding with the comprehension check, then complete the activity and assignment below to progress to the next lesson in your transformation journey. Understanding comes before action, Legacy Builder!
            `;

            currentUtterance = new SpeechSynthesisUtterance(fullText);

            // Restore user's preferred speed or use default
            const savedSpeed = parseFloat(localStorage.getItem('coach_audio_speed')) || 0.9;
            currentUtterance.rate = savedSpeed;
            currentUtterance.pitch = 1.0;
            currentUtterance.volume = 1.0;

            // Update speed display
            const speedDisplay = document.getElementById('speedDisplay');
            if (speedDisplay) {
                speedDisplay.textContent = savedSpeed + 'x';
            }

            console.log('üéµ Audio speed set to:', savedSpeed + 'x');

            // Initialize audio timing
            audioTotalChars = fullText.length;
            audioCurrentChar = 0;
            audioEstimatedDuration = estimateAudioDuration(audioTotalChars, savedSpeed);

            // Update initial time display
            const timeEl = document.getElementById('audioTime');
            if (timeEl) {
                timeEl.textContent = `0:00 / ${formatTime(audioEstimatedDuration)}`;
            }

            console.log(`üìä Estimated duration: ${formatTime(audioEstimatedDuration)} (${audioTotalChars} characters)`);

            // Wait for voices to load and select best quality voice
            let voiceSelected = false;

            const selectBestVoice = () => {
                const voices = speechSynthesis.getVoices();
                console.log('üé§ Available voices:', voices.length);

                if (voices.length > 0 && !voiceSelected) {
                    // Log all available voices for debugging
                    console.log('üåç All voices:', voices.map(v => `${v.name} (${v.lang})`).join(', '));

                    // Prefer African male voices (South African, Nigerian, Kenyan, etc.)
                    const preferredVoice =
                        // South African English voices (Microsoft, Google)
                        voices.find(v => v.lang === 'en-ZA' && !v.name.toLowerCase().includes('female')) ||
                        voices.find(v => v.lang === 'en-ZA') ||

                        // African-accented English voices
                        voices.find(v => (v.name.includes('Thabo') || v.name.includes('Luke')) && v.lang.startsWith('en')) || // Microsoft SA voices
                        voices.find(v => v.name.includes('Nigerian') && v.lang.startsWith('en')) ||
                        voices.find(v => v.name.includes('Kenyan') && v.lang.startsWith('en')) ||

                        // General African region voices
                        voices.find(v => v.lang.startsWith('en-') && (v.name.includes('Africa') || v.name.includes('ZA'))) ||

                        // Fallback to quality English male voices
                        voices.find(v => v.name.includes('Google UK English Male')) ||
                        voices.find(v => v.name.includes('Microsoft David')) || // UK male
                        voices.find(v => v.name.includes('Microsoft George')) || // UK male
                        voices.find(v => v.name.includes('Google') && v.lang === 'en-GB') || // UK English
                        voices.find(v => v.name.includes('Daniel') && v.lang.startsWith('en')) || // MacOS UK

                        // Last resort fallback
                        voices.find(v => v.lang.startsWith('en-GB')) || // Any UK voice
                        voices.find(v => v.lang.startsWith('en-US')) || // US voice
                        voices.find(v => v.lang.startsWith('en')); // Any English

                    if (preferredVoice) {
                        currentUtterance.voice = preferredVoice;
                        console.log('‚úÖ Selected voice:', preferredVoice.name, '(' + preferredVoice.lang + ')');
                        voiceSelected = true;
                    } else {
                        console.log('‚ö†Ô∏è No preferred voice found, using default');
                    }
                }
            };

            // Try to select voice immediately
            selectBestVoice();

            // If voices aren't loaded yet, wait for them
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.onvoiceschanged = selectBestVoice;
            }

            // Update progress during playback
            currentUtterance.onboundary = (event) => {
                // Track current character position
                audioCurrentChar = event.charIndex;

                // Update progress bar
                const progress = (event.charIndex / fullText.length) * 100;
                const progressBar = document.getElementById('audioProgressBar');
                if (progressBar) {
                    progressBar.style.width = progress + '%';
                }

                // Update handle position
                const handle = document.getElementById('audioProgressHandle');
                if (handle) {
                    handle.style.left = progress + '%';
                }
            };

            currentUtterance.onstart = () => {
                console.log('üéµ Audio playback started');
                isAudioPlaying = true;
                audioStartTime = Date.now();

                // Start progress interval for time updates
                if (audioProgressInterval) {
                    clearInterval(audioProgressInterval);
                }
                audioProgressInterval = setInterval(updateAudioTime, 500); // Update every 500ms

                // Initial time update
                updateAudioTime();
            };

            currentUtterance.onend = () => {
                console.log('üéµ Audio playback ended');
                isAudioPlaying = false;

                // Clear progress interval
                if (audioProgressInterval) {
                    clearInterval(audioProgressInterval);
                    audioProgressInterval = null;
                }

                const playBtn = document.getElementById('playPauseBtn');
                const progressBar = document.getElementById('audioProgressBar');
                const progressText = document.getElementById('audioProgress');
                const timeDisplay = document.getElementById('audioTime');

                if (playBtn) playBtn.innerHTML = '<i class="fas fa-play"></i>';
                if (progressBar) progressBar.style.width = '100%';
                if (progressText) progressText.textContent = 'Completed!';
                if (timeDisplay) timeDisplay.textContent = `${formatTime(audioEstimatedDuration)} / ${formatTime(audioEstimatedDuration)}`;

                // Reset after a moment
                setTimeout(() => {
                    if (progressBar) progressBar.style.width = '0%';
                    if (progressText) progressText.textContent = 'Ready to play';
                    if (timeDisplay) timeDisplay.textContent = `0:00 / ${formatTime(audioEstimatedDuration)}`;
                }, 2000);
            };

            currentUtterance.onerror = (event) => {
                console.error('‚ùå Audio error:', event.error);
                alert('Audio playback error: ' + event.error);
                isAudioPlaying = false;
                const playBtn = document.getElementById('playPauseBtn');
                if (playBtn) playBtn.innerHTML = '<i class="fas fa-play"></i>';
            };

            console.log('‚úÖ Audio prepared successfully');
        }

        // Toggle audio play/pause
        function toggleAudio() {
            console.log('üéµ Toggle audio called, current state:', isAudioPlaying);

            // Prepare audio if not yet prepared
            if (!currentUtterance) {
                console.log('üìù Preparing audio for first time...');
                prepareAudio();

                // Give it a moment to prepare
                setTimeout(() => {
                    if (currentUtterance) {
                        speechSynthesis.speak(currentUtterance);
                        isAudioPlaying = true;
                        document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i>';
                    }
                }, 100);
                return;
            }

            if (isAudioPlaying) {
                // Pause
                console.log('‚è∏Ô∏è Pausing audio...');
                speechSynthesis.pause();
                isAudioPlaying = false;
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i>';
            } else {
                // Resume or play
                if (speechSynthesis.paused) {
                    console.log('‚ñ∂Ô∏è Resuming audio...');
                    speechSynthesis.resume();
                } else {
                    console.log('‚ñ∂Ô∏è Starting audio...');
                    speechSynthesis.speak(currentUtterance);
                }
                isAudioPlaying = true;
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i>';
            }
        }

        // Stop audio
        function stopAudio() {
            console.log('üõë Stopping audio...');
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            isAudioPlaying = false;
            currentUtterance = null; // Clear utterance
            if (document.getElementById('playPauseBtn')) {
                document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-play"></i>';
            }
            if (document.getElementById('audioProgressBar')) {
                document.getElementById('audioProgressBar').style.width = '0%';
            }
            if (document.getElementById('audioProgress')) {
                document.getElementById('audioProgress').textContent = 'Ready to play';
            }
            if (document.getElementById('audioTime')) {
                document.getElementById('audioTime').textContent = '0:00 / 0:00';
            }

            // Clear progress interval
            if (audioProgressInterval) {
                clearInterval(audioProgressInterval);
                audioProgressInterval = null;
            }

            // Reset audio timing
            audioCurrentChar = 0;
            audioStartTime = 0;
        }

        // Format seconds to MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // Estimate audio duration based on text length and speech rate
        function estimateAudioDuration(textLength, rate = 0.9) {
            // Average speaking rate is ~150 words per minute at 1.0x speed
            // Adjust for speech rate
            const wordsPerMinute = 150 * rate;
            const charsPerWord = 5; // Average
            const words = textLength / charsPerWord;
            const durationMinutes = words / wordsPerMinute;
            return durationMinutes * 60; // Convert to seconds
        }

        // Update time display during playback
        function updateAudioTime() {
            if (!isAudioPlaying || !audioTotalChars) return;

            const elapsed = (Date.now() - audioStartTime) / 1000;
            const progress = (audioCurrentChar / audioTotalChars) * 100;
            const estimatedElapsed = (audioEstimatedDuration * progress) / 100;
            const remaining = Math.max(0, audioEstimatedDuration - estimatedElapsed);

            // Update time display
            const timeEl = document.getElementById('audioTime');
            if (timeEl) {
                timeEl.textContent = `${formatTime(estimatedElapsed)} / ${formatTime(audioEstimatedDuration)}`;
            }

            // Update progress text
            const progressEl = document.getElementById('audioProgress');
            if (progressEl) {
                progressEl.textContent = `Playing... ${Math.round(progress)}%`;
            }

            // Show/hide progress handle
            const handle = document.getElementById('audioProgressHandle');
            if (handle) {
                handle.style.opacity = progress > 0 ? '1' : '0';
            }
        }

        // Seek to position (not fully supported by Speech Synthesis API, but we try)
        function seekAudio(event) {
            // Note: Web Speech API doesn't support true seeking
            // This is a visual-only feature for now
            alert('Seeking is not supported by the browser speech engine.\n\nYou can use the speed controls to adjust playback pace.');
        }

        // Set audio playback speed
        function setAudioSpeed(speed) {
            console.log('‚ö° Setting audio speed to:', speed);

            // Update display
            const speedDisplay = document.getElementById('speedDisplay');
            if (speedDisplay) {
                speedDisplay.textContent = speed + 'x';
            }

            // Update current utterance if it exists
            if (currentUtterance) {
                const wasPlaying = isAudioPlaying;

                // Stop current playback
                if (speechSynthesis.speaking) {
                    speechSynthesis.cancel();
                }

                // Update rate
                currentUtterance.rate = speed;

                // Resume if it was playing
                if (wasPlaying) {
                    setTimeout(() => {
                        speechSynthesis.speak(currentUtterance);
                        isAudioPlaying = true;
                        document.getElementById('playPauseBtn').innerHTML = '<i class="fas fa-pause"></i>';
                    }, 100);
                }
            }

            // Save preference
            localStorage.setItem('coach_audio_speed', speed);

            // Update button styles
            const buttons = document.querySelectorAll('#audioPlayer button[onclick^="setAudioSpeed"]');
            buttons.forEach(btn => {
                const btnSpeed = parseFloat(btn.textContent);
                if (btnSpeed === speed) {
                    btn.style.background = 'linear-gradient(135deg, var(--gold), var(--orange))';
                    btn.style.color = 'var(--navy-blue)';
                    btn.style.border = 'none';
                    btn.style.fontWeight = '600';
                } else {
                    btn.style.background = 'rgba(255,255,255,0.1)';
                    btn.style.color = 'white';
                    btn.style.border = '1px solid rgba(255,255,255,0.2)';
                    btn.style.fontWeight = 'normal';
                }
            });

            console.log('‚úÖ Audio speed set successfully');
        }

        // Start animated lesson presentation
        function startAnimation() {
            const lesson = getLessonByDay(currentDay);
            if (!lesson) return;

            animationPaused = false;
            const container = document.getElementById('animatedLesson');

            // Create animated slides
            const slides = [
                { type: 'title', content: `Day ${currentDay}`, subtext: lesson.title, duration: 3000 },
                { type: 'text', content: lesson.content, duration: 8000 },
                { type: 'activity', content: lesson.activity, duration: 6000 },
                { type: 'assignment', content: lesson.assignment, duration: 6000 },
                { type: 'complete', content: 'Lesson Complete!', subtext: 'Mark as complete when ready', duration: 3000 }
            ];

            let currentSlide = 0;

            function showSlide() {
                if (animationPaused) return;

                const slide = slides[currentSlide];
                container.innerHTML = '';

                if (slide.type === 'title') {
                    container.innerHTML = `
                        <div style="animation: fadeInUp 1s ease;">
                            <div style="font-size: 3rem; margin-bottom: 1rem;">${lesson.phaseTitle.includes('üß†') ? 'üß†' : lesson.phaseTitle.includes('üí∏') ? 'üí∏' : lesson.phaseTitle.includes('‚öôÔ∏è') ? '‚öôÔ∏è' : 'üåç'}</div>
                            <div style="font-size: 1.2rem; color: var(--orange); font-weight: 600; margin-bottom: 0.5rem;">${slide.content}</div>
                            <div style="font-size: 1.8rem; color: var(--gold); font-weight: 700;">${slide.subtext}</div>
                        </div>
                    `;
                } else if (slide.type === 'text') {
                    container.innerHTML = `
                        <div style="animation: fadeInUp 1s ease;">
                            <div style="font-size: 1.2rem; color: var(--gold); font-weight: 600; margin-bottom: 1.5rem;">üìñ Content</div>
                            <div style="font-size: 1rem; line-height: 1.8; text-align: left; max-width: 600px; margin: 0 auto;">${slide.content}</div>
                        </div>
                    `;
                } else if (slide.type === 'activity') {
                    container.innerHTML = `
                        <div style="animation: fadeInUp 1s ease;">
                            <div style="font-size: 1.2rem; color: var(--success); font-weight: 600; margin-bottom: 1.5rem;">üéØ Activity</div>
                            <div style="font-size: 1.1rem; line-height: 1.8; text-align: left; max-width: 600px; margin: 0 auto;">${slide.content}</div>
                        </div>
                    `;
                } else if (slide.type === 'assignment') {
                    container.innerHTML = `
                        <div style="animation: fadeInUp 1s ease;">
                            <div style="font-size: 1.2rem; color: var(--purple); font-weight: 600; margin-bottom: 1.5rem;">üìù Assignment</div>
                            <div style="font-size: 1.1rem; line-height: 1.8; text-align: left; max-width: 600px; margin: 0 auto;">${slide.content}</div>
                        </div>
                    `;
                } else if (slide.type === 'complete') {
                    container.innerHTML = `
                        <div style="animation: zoomIn 0.8s ease;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">üéâ</div>
                            <div style="font-size: 2rem; color: var(--gold); font-weight: 700; margin-bottom: 0.5rem;">${slide.content}</div>
                            <div style="font-size: 1rem; opacity: 0.8;">${slide.subtext}</div>
                        </div>
                    `;
                }

                currentSlide++;
                if (currentSlide < slides.length) {
                    animationInterval = setTimeout(showSlide, slide.duration);
                } else {
                    currentSlide = 0; // Loop back
                }
            }

            showSlide();

            // Add CSS animations
            if (!document.getElementById('animationStyles')) {
                const style = document.createElement('style');
                style.id = 'animationStyles';
                style.textContent = `
                    @keyframes fadeInUp {
                        from {
                            opacity: 0;
                            transform: translateY(30px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                    @keyframes zoomIn {
                        from {
                            opacity: 0;
                            transform: scale(0.5);
                        }
                        to {
                            opacity: 1;
                            transform: scale(1);
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }

        // Pause animation
        function pauseAnimation() {
            animationPaused = !animationPaused;
            const btn = document.getElementById('pauseAnimBtn');
            if (animationPaused) {
                clearTimeout(animationInterval);
                btn.innerHTML = '<i class="fas fa-play"></i> Resume';
            } else {
                btn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                startAnimation();
            }
        }

        // Restart animation
        function restartAnimation() {
            stopAnimation();
            startAnimation();
        }

        // Stop animation
        function stopAnimation() {
            if (animationInterval) {
                clearTimeout(animationInterval);
                animationInterval = null;
            }
            animationPaused = false;
        }

        // Update viewLesson to initialize learning mode
        const originalViewLesson = viewLesson;
        viewLesson = function() {
            originalViewLesson();
            // Set initial learning mode
            setLearningMode(learningMode);
        };

        // ===== VIDZIE VIDEO COACHING INTEGRATION =====

        const API_BASE_URL = 'http://localhost:5000/api';
        let currentCoachingVideoId = null;
        let currentCoachingVideoUrl = null;

        // Generate coaching video using VIDZIE
        async function generateCoachingVideo() {
            const lesson = getLessonByDay(currentDay);
            if (!lesson) {
                alert('No lesson found for current day');
                return;
            }

            // Check for auth token, or create demo token for LIFETIME users
            let authToken = localStorage.getItem('z2b_auth_token');
            if (!authToken) {
                // Check if user is initialized as LIFETIME tier
                const user = JSON.parse(localStorage.getItem('z2b_current_user') || '{}');
                if (user.tier === 'LIFETIME') {
                    // Create demo auth token for LIFETIME tier users
                    authToken = 'demo_lifetime_' + user.id + '_' + Date.now();
                    localStorage.setItem('z2b_auth_token', authToken);
                    console.log('‚úÖ Created demo auth token for LIFETIME user');
                } else {
                    alert('Please login to generate video lessons');
                    return;
                }
            }

            try {
                // Disable button and show progress
                const btn = document.getElementById('btnGenerateCoachVideo');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
                document.getElementById('videoGenerationProgress').style.display = 'block';

                // Get current stage info for context
                const stageInfo = getCurrentStage(currentDay);
                console.log('üé• Generating stage-aware video for Day', currentDay, '- Stage', stageInfo.stage + ':', stageInfo.name);

                // Create stage-aware video script from lesson
                const videoScript = `
Hi! I'm Coach Manlaw, your guide from employee to entrepreneur!

Welcome to Day ${currentDay} of your 90-day transformation journey.

You are in Stage ${stageInfo.stage}: ${stageInfo.name}. This is where you ${stageInfo.focus}.

Right now, we're focusing on ${stageInfo.leg}.

Today's lesson is: ${lesson.title}.

${lesson.content}

Now, here's your activity for today: ${lesson.activity}

And your assignment: ${lesson.assignment}

Remember, Legacy Builder: You're on ${lesson.phaseTitle.split(':')[0]}, and this stage is about ${lesson.theme}.

Stage ${stageInfo.stage} is critical to your transformation. Stay focused, keep building, and let's make today count!

I am a Legacy Builder, You are a Legacy Builder, and Together we are Builders of Legacies!
                `.trim();

                // Use Coach Manlaw avatar (professional male)
                const coachAvatar = 'https://api.dicebear.com/7.x/avataaars/svg?seed=CoachManlaw&style=circle';

                // Generate video with VIDZIE API

                const response = await fetch(`${API_BASE_URL}/vidzie/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        videoName: `Coach Manlaw - Day ${currentDay} - Stage ${stageInfo.stage}: ${stageInfo.name} - ${lesson.title}`,
                        description: `Stage ${stageInfo.stage} (${stageInfo.name}) - Day ${currentDay} of 90-day transformation: ${lesson.title}`,
                        videoType: 'coaching',
                        purpose: 'coach-manlaw',
                        sourceImage: coachAvatar,
                        script: videoScript.substring(0, 5000), // Limit to 5000 chars
                        voiceId: 'en-ZA-LukeNeural', // South African male voice (African accent)
                        settings: {
                            resolution: 'HD',
                            stage: stageInfo.stage,
                            stageName: stageInfo.name
                        }
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentCoachingVideoId = data.data.videoId;

                    // Poll for video completion
                    pollCoachingVideoStatus(currentCoachingVideoId);
                } else {
                    throw new Error(data.message || 'Failed to generate video');
                }

            } catch (error) {
                console.error('Video generation error:', error);

                // Provide helpful error message
                let errorMsg = error.message;
                if (error.message.includes('Failed to fetch') || error.message.includes('NetworkError')) {
                    errorMsg = 'Cannot connect to video generation server.\n\n' +
                               'The backend server needs to be running at http://localhost:5000\n\n' +
                               'For now, use the animated slides in Watch mode, or use Listen mode with audio narration.';
                }

                alert('Error generating video:\n\n' + errorMsg);

                // Reset button
                const btn = document.getElementById('btnGenerateCoachVideo');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic"></i> Generate Video Lesson';
                document.getElementById('videoGenerationProgress').style.display = 'none';
            }
        }

        // Poll for coaching video completion
        async function pollCoachingVideoStatus(videoId, attempts = 0) {
            const maxAttempts = 60; // 5 minutes
            const authToken = localStorage.getItem('z2b_auth_token');

            try {
                const response = await fetch(`${API_BASE_URL}/vidzie/video/${videoId}/status`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    const { status, progress, videoUrl } = data.data;

                    // Update progress bar
                    document.getElementById('videoGenProgressBar').style.width = progress + '%';

                    if (status === 'completed' && videoUrl) {
                        // Video is ready!
                        currentCoachingVideoUrl = videoUrl;
                        displayCoachingVideo(videoUrl);

                        // Reset button
                        const btn = document.getElementById('btnGenerateCoachVideo');
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fas fa-check"></i> Video Generated!';
                        document.getElementById('videoGenerationProgress').style.display = 'none';

                        // Send success message to chat
                        const stageInfo = getCurrentStage(currentDay);
                        addCoachMessage(`
                            <strong>üé• Your Video Lesson is Ready!</strong><br><br>
                            I've created a personalized video lesson for Day ${currentDay} - Stage ${stageInfo.stage}: ${stageInfo.name}.<br><br>
                            This video covers your current transformation stage and includes all the guidance you need for today's lesson.<br><br>
                            <em>Pro tip: Download it to your device so you can watch offline anytime!</em>
                        `);

                        return;
                    }

                    if (status === 'failed') {
                        throw new Error('Video generation failed');
                    }

                    // Continue polling
                    if (attempts < maxAttempts) {
                        setTimeout(() => pollCoachingVideoStatus(videoId, attempts + 1), 5000);
                    } else {
                        throw new Error('Video generation timeout');
                    }
                }

            } catch (error) {
                console.error('Poll video error:', error);
                alert('Video generation failed: ' + error.message);

                // Reset button
                const btn = document.getElementById('btnGenerateCoachVideo');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic"></i> Generate Video Lesson';
                document.getElementById('videoGenerationProgress').style.display = 'none';
            }
        }

        // Display coaching video
        function displayCoachingVideo(videoUrl) {
            const videoSection = document.getElementById('generatedVideoSection');
            const videoSource = document.getElementById('videoSource');
            const videoPlayer = document.getElementById('coachingVideoPlayer');
            const generateSection = document.getElementById('videoGenerateSection');
            const animatedSection = document.getElementById('animatedLesson');

            // Hide generate section and animation
            generateSection.style.display = 'none';
            animatedSection.style.display = 'none';
            stopAnimation();

            // Show video
            videoSource.src = videoUrl;
            videoPlayer.load();
            videoSection.style.display = 'block';
        }

        // Download coaching video
        async function downloadCoachingVideo() {
            if (!currentCoachingVideoUrl) {
                alert('No video available to download');
                return;
            }

            try {
                // Track download
                const authToken = localStorage.getItem('z2b_auth_token');
                if (currentCoachingVideoId && authToken) {
                    await fetch(`${API_BASE_URL}/vidzie/video/${currentCoachingVideoId}/download`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                }

                // Download video with stage info in filename
                const lesson = getLessonByDay(currentDay);
                const stageInfo = getCurrentStage(currentDay);
                const link = document.createElement('a');
                link.href = currentCoachingVideoUrl;
                link.download = `Coach-Manlaw-Day-${currentDay}-Stage-${stageInfo.stage}-${stageInfo.name}-${lesson.title.replace(/[^a-z0-9]/gi, '-')}.mp4`;
                link.click();

                addCoachMessage('‚úÖ Video downloaded! Keep building, Legacy Builder!');

            } catch (error) {
                console.error('Download error:', error);
                alert('Error downloading video: ' + error.message);
            }
        }

        // Share coaching video
        async function shareCoachingVideo() {
            if (!currentCoachingVideoId) {
                alert('No video available to share');
                return;
            }

            try {
                const authToken = localStorage.getItem('z2b_auth_token');

                const response = await fetch(`${API_BASE_URL}/vidzie/video/${currentCoachingVideoId}/share`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    const shareUrl = data.data.shareUrl;

                    // Copy to clipboard
                    navigator.clipboard.writeText(shareUrl);

                    addCoachMessage(`
                        <strong>üîó Share Link Created!</strong><br><br>
                        Link copied to clipboard: <a href="${shareUrl}" target="_blank" style="color: var(--gold);">${shareUrl}</a><br><br>
                        Share this lesson with your team, accountability partner, or anyone building their legacy!
                    `);
                } else {
                    throw new Error(data.message || 'Failed to create share link');
                }

            } catch (error) {
                console.error('Share error:', error);
                alert('Error sharing video: ' + error.message);
            }
        }

        // ===== INITIALIZATION =====

        // Initialize page on load
        function initializePage() {
            console.log('üéØ Coach ManLaw: Initializing...');

            // Initialize user as LIFETIME tier if not already set
            const storedUser = localStorage.getItem('z2b_current_user');
            if (!storedUser || JSON.parse(storedUser).tier !== 'LIFETIME') {
                console.log('üîß Initializing user as LIFETIME tier (Premium Legacy Builder)');
                const lifetimeUser = {
                    id: 'user_mokoro_manana',
                    name: 'Mokoro Manana',
                    tier: 'LIFETIME',
                    aiFuel: 999999, // Unlimited AI Fuel
                    joinDate: new Date().toISOString(),
                    isDemo: false,
                    legacyBuilder: true // Premium Legacy Builder status
                };
                localStorage.setItem('z2b_current_user', JSON.stringify(lifetimeUser));
                // Update userTier variable
                userTier = getUserTier();
                console.log('‚úÖ User initialized:', lifetimeUser.name, '- Tier:', userTier);
            } else {
                console.log('‚úÖ User already initialized:', JSON.parse(storedUser).name);
            }

            // Load curriculum
            if (typeof MANLAW_CURRICULUM !== 'undefined') {
                curriculum = MANLAW_CURRICULUM;
                console.log('‚úÖ Curriculum loaded from MANLAW_CURRICULUM');
            } else {
                console.warn('‚ö†Ô∏è MANLAW_CURRICULUM not loaded yet');
            }

            // Update displays
            updateCurrentLesson();
            updateJourneyDay();
            if (btssScores) {
                updateBTSSDisplay();
            }

            // Render 90-day lesson overview (with small delay to ensure curriculum is loaded)
            setTimeout(() => {
                renderLessonOverview();
                console.log('‚úÖ Lesson overview rendered');
            }, 500);

            // Set welcome time
            const now = new Date();
            document.getElementById('welcomeTime').textContent =
                now.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

            console.log('‚úÖ Coach ManLaw: Ready!');
            console.log('Current Day:', currentDay);
            console.log('Functions available:', {
                viewLesson: typeof viewLesson,
                openAssessment: typeof openAssessment,
                showProgress: typeof showProgress
            });
        }

        // Run on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializePage);
        } else {
            initializePage();
        }

        // ====================================================================
        // CRITICAL FIX: Expose functions to global scope for onclick handlers
        // ====================================================================
        // All buttons use inline onclick attributes which execute in global scope.
        // These assignments make the functions accessible from window object.
        window.viewLesson = viewLesson;
        window.openAssessment = openAssessment;
        window.showProgress = showProgress;
        window.closeProgress = closeProgress;
        window.completeLesson = completeLesson;
        window.previousDay = previousDay;
        window.nextDay = nextDay;
        window.closeLessonModal = closeLessonModal;
        window.closeAssessment = closeAssessment;
        window.submitAssessment = submitAssessment;
        window.showSettings = showSettings;
        window.closeSettings = closeSettings;
        window.saveSettings = saveSettings;
        window.sendMessage = sendMessage;
        window.setLearningMode = setLearningMode;
        window.toggleAudio = toggleAudio;
        window.stopAudio = stopAudio;
        window.playAnimatedLesson = playAnimatedLesson;
        window.restartAnimation = restartAnimation;
        window.pauseAnimation = pauseAnimation;
        window.generateCoachingVideo = generateCoachingVideo;
        window.downloadCoachingVideo = downloadCoachingVideo;
        window.shareCoachingVideo = shareCoachingVideo;

        console.log('‚úÖ All functions exposed to global scope - buttons ready!');
    </script>

    <!-- Load Curriculum -->
    <script src="coach-manlaw-curriculum.js" onerror="console.warn('‚ö†Ô∏è Failed to load curriculum file')"></script>
    <script>
        // Reload curriculum after external script loads
        if (typeof MANLAW_CURRICULUM !== 'undefined' && typeof curriculum !== 'undefined') {
            curriculum = MANLAW_CURRICULUM;
            if (typeof updateCurrentLesson === 'function') {
                updateCurrentLesson();
            }
            console.log('‚úÖ Curriculum loaded from external file');
        } else {
            console.warn('‚ö†Ô∏è Curriculum not available - buttons will still work with modals');
        }
    </script>

    <!-- Z2B Ecosystem Integration (optional) -->
    <script src="../js/app-config.js" onerror="console.warn('‚ö†Ô∏è app-config.js not found (optional)')"></script>
    <script src="../js/ecosystem-footer.js" onerror="console.warn('‚ö†Ô∏è ecosystem-footer.js not found (optional)')"></script>
</body>

</html>